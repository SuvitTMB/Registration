<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ttb registration</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #ffffff; 
        }
        /* (คงไว้) Style สำหรับ Edit Modal Inputs */
        #editEmployeeModal input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            margin-top: 0.25rem;
        }
         /* (คงไว้) Style สำหรับ Dropdown ฟ้าอ่อน */
        select.light-blue-bg {
             background-color: #ffffff; 
             padding-left: 0.75rem; /* px-3 */
             padding-right: 0.75rem; /* px-3 */
             padding-top: 0.5rem; /* py-2 */
             padding-bottom: 0.5rem; /* py-2 */
        }
         /* (คงไว้) Style หัวตารางสีเทา */
        thead.table-header-gray {
             background-color: #e5e7eb; /* gray-200 */
        }
        /* (เพิ่ม) Style สำหรับ Textbox รางวัลพิเศษ */
        #specialRewardLimitInput {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            text-align: center;
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            color: #166534; /* green-800 */
        }
        
        /* (เพิ่ม) Style สำหรับ Modal รายละเอียดพนักงาน */
        #detailEmployeeModal input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            margin-top: 0.25rem;
            background-color: #f9fafb; /* gray-50 */
            cursor: default;
        }
    </style>
    <!-- Chart.js CDN --><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body class="flex flex-col items-center min-h-screen py-10 bg-white">

    <div class="w-[90%] max-w-6xl p-0 bg-white rounded-lg"> 
        <!-- Header --><div class="flex flex-col items-center mb-6 pt-6 px-8"> 
            <div class="text-center">
                <h1 class="text-2xl font-bold" style="color: #0056ff;">ระบบลงทะเบียน</h1>
            </div>
            <div class="text-center mt-2">
                <p id="currentDateTime" class="text-sm text-gray-600 font-medium"></p>
            </div>
        </div>
        
        <!-- Tab Navigation (แก้ไข: ลบแท็บ 'ข้อมูลจัดกลุ่ม' และเปลี่ยนชื่อแท็บ) --><div class="mb-6 border-b border-gray-200 px-8"> 
            <nav class="-mb-px flex space-x-1" aria-label="Tabs"> 
                <button id="tab-dashboard" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-700 bg-gray-300 border-blue-600">
                    ข้อมูล Dashboard
                </button>
                <button id="tab-team-list" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลผู้ลงทะเบียน <!-- (แก้ไข) เปลี่ยนชื่อ -->
                </button>
                <!-- (ลบ) แท็บ 'ข้อมูลจัดกลุ่ม' -->
                
                <button id="tab-employee-list" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลผู้ได้รับรางวัล <!-- (แก้ไข) เปลี่ยนชื่อเป็นข้อมูลผู้ได้รับรางวัล -->
                </button>
                
                <button id="tab-register" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ลงทะเบียนเข้าร่วมงาน
                </button>
            </nav>
        </div>

        <!-- Dashboard Content --><div id="dashboard-content" class="px-8 pb-8"> 
            
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-800">ภาพรวมผู้ลงทะเบียน</h2>
                <button id="randomizeButton" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                    สุ่มเลือกผู้ร่วมงาน
                </button>
            </div>
            
            <div class="flex flex-col lg:flex-row gap-6 mb-8">
                
                <!-- กล่องที่ 1 (40%) --><div class="lg:w-2/5"> 
                     <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center h-full">
                         <p class="text-gray-600 text-sm mb-4">สัดส่วนผู้ลงทะเบียน</p>
                         <div class="relative w-64 h-64"> 
                             <canvas id="registrationBreakdownChart"></canvas>
                             <div class="absolute inset-0 flex flex-col items-center justify-center">
                                 <span id="breakdownCenterTotal" class="text-3xl font-bold text-gray-900">0</span>
                                 <span class="text-sm text-gray-500">ผู้ลงทะเบียน</span>
                             </div>
                         </div>
                     </div>
                </div>

                <!-- กล่องที่ 2 (60%) : กราฟวงกลมและสรุปยอด --><div class="lg:w-3/5"> 
                    <div class="flex gap-6 h-full">
                         
                         <div class="w-2/3 bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center"> 
                            <p class="text-gray-600 text-sm mb-4">เป้าหมายผู้ลงทะเบียน</p>
                            <div class="relative w-64 h-64"> 
                                <canvas id="registrationDonutChart"></canvas>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span id="donutPercentage" class="text-3xl font-bold text-gray-900">0%</span>
                                    <span class="text-sm text-gray-500">ผู้เข้าร่วมกิจกรรม</span>
                                </div>
                            </div>
                        </div>
                         
                         <!-- Metric Boxes (5 boxes now) --><div class="w-1/3 flex flex-col justify-between space-y-2 h-full"> 
                            <!-- 1. จำนวนเป้าหมาย (Blue) --><div class="bg-blue-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> 
                                <p class="text-blue-700 text-xs">จำนวนเป้าหมาย</p> 
                                <p id="targetCount" class="text-lg font-bold text-blue-800 mt-1">0</p> 
                            </div>
                            <!-- 2. ผู้เข้าร่วมกิจกรรม (Green) --><div class="bg-green-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> 
                                <p class="text-green-700 text-xs">ผู้เข้าร่วมกิจกรรม</p> 
                                <p id="participantsCountBox" class="text-lg font-bold text-green-800 mt-1">0</p> 
                            </div>
                             <!-- 3. ผู้ร่วมงาน (Yellow) --><div class="bg-yellow-50 p-3 rounded-lg flex flex-col justify-center items-center text-center">
                                <p class="text-yellow-700 text-xs">ผู้ร่วมงาน</p>
                                <p id="attendeesCount" class="text-lg font-bold text-yellow-800 mt-1">0</p>
                            </div>
                            <!-- 4. ยืนยันรับรางวัล (NEW - Slate/Gray) --><div class="bg-slate-100 p-3 rounded-lg flex flex-col justify-center items-center text-center">
                                <p class="text-slate-700 text-xs">ยืนยันรับรางวัล</p>
                                <p id="confirmedRewardCount" class="text-lg font-bold text-slate-800 mt-1">0</p>
                            </div>
                            <!-- 5. จำนวนคงเหลือ (Red) --><div class="bg-red-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> 
                                <p class="text-red-700 text-xs">จำนวนคงเหลือ</p> 
                                <p id="remainingCount" class="text-lg font-bold text-red-800 mt-1">0</p> 
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- สรุปข้อมูลผู้ลงทะเบียน --><div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                     <h2 class="text-lg font-semibold text-gray-800">สรุปข้อมูลผู้ลงทะเบียนตามสังกัด (Chief)</h2>
                 </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> 
                    <!-- กล่องซ้าย: กราฟแท่ง 1 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <p class="text-gray-600 text-sm mb-4">กราฟแสดงข้อมูลสถิติ (ส่วนที่ 1)</p>
                        <div class="h-[25rem]"> 
                            <canvas id="teamBarChart1"></canvas> 
                        </div>
                    </div>
                    <!-- กล่องขวา: กราฟแท่ง 2 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                         <p class="text-gray-600 text-sm mb-4">กราฟแสดงข้อมูลสถิติ (ส่วนที่ 2)</p>
                        <div class="h-[25rem]"> 
                            <canvas id="teamBarChart2"></canvas> 
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- สรุปข้อมูลผู้ร่วมงานและรายชื่อล่าสุด (แก้ไขคอลัมน์) --><h2 class="text-lg font-semibold text-gray-800 mb-4">สรุปข้อมูลผู้ร่วมงานและรายชื่อล่าสุด (50 รายการล่าสุด)</h2>
            <div class="bg-white shadow-md rounded-lg overflow-hidden border border-gray-200">
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm">
                        <thead class="table-header-gray"> 
                            <tr>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล (รหัสพนักงาน)</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">Chief</th> <!-- (แก้ไข) เปลี่ยนเป็น Chief -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รางวัล</th> <!-- (แก้ไข) เปลี่ยนเป็น รางวัล (เช็ค DateReward) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รับแล้ว</th> <!-- (แก้ไข) เปลี่ยนเป็น รับแล้ว (เช็ค ConfirmReward) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">เวลาที่ลงทะเบียน</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลบรายการ</th>
                            </tr>
                        </thead>
                        <tbody id="latestRegistrationsTableBody" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="6" class="p-6 text-center text-gray-500">กำลังโหลดข้อมูล...</td> <!-- (แก้ไข) Colspan เป็น 6 -->
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ปุ่ม Download CSV --><div class="mt-6 text-center">
                <button id="downloadCsvButton" class="px-5 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                    Download File CSV (ผู้ลงทะเบียน)
                </button>
            </div>
            
        </div>

        <!-- Register Content --><div id="register-content" class="hidden pb-8 px-6">
             <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center">
                <h2 class="text-xl font-semibold text-gray-800 text-center mb-6">สแกน QR Code เพื่อลงทะเบียนเข้าร่วมงาน</h2>
                <img 
                    src="./images/QRcode-CRSG.png" 
                    alt="QR Code ลงทะเบียน" 
                    class="rounded-lg shadow-md border border-gray-200" 
                    style=" width:40%;"
                >
             </div>
        </div>


        <!-- (แก้ไข) Team List Content (ปรับปรุงใหม่ทั้งหมด) -->
        <div id="team-list-content" class="hidden pb-8 px-0"> 
            <div class="bg-white overflow-hidden"> 
                <!-- Top Stats/Actions Bar (แก้ไข: ปรับปรุงกล่อง) -->
                <!-- NEW: Grid 4x (25% each) -->
                <div class="px-6 py-4 border-b grid grid-cols-2 lg:grid-cols-4 gap-4 items-center"> 
                    <!-- Stat 1: ลงทะเบียนล่วงหน้า (25%) -->
                    <div class="w-full bg-blue-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-blue-700">ลงทะเบียนล่วงหน้า</p> 
                        <p id="managerEmployeeCount" class="text-2xl font-bold text-blue-900 mt-1">0</p>
                    </div>
                    
                    <!-- Stat 2: จำนวนผู้ที่จะได้รับรางวัลพิเศษ (25%) -->
                    <div class="w-full bg-green-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-green-700">จำนวนผู้ที่จะได้รับรางวัลพิเศษ</p>
                        <!-- (แก้ไข) เปลี่ยนเป็น Textbox -->
                        <input type="number" id="specialRewardLimitInput" class="mt-1" value="0">
                    </div>
                    
                    <!-- Stat 3: ผู้รับรางวัลแล้ว (25%) -->
                    <div class="w-full bg-orange-50 p-4 rounded-lg text-center"> <!-- (แก้ไข) สีส้ม -->
                        <p class="text-sm text-orange-700">ผู้รับรางวัลแล้ว</p> <!-- (แก้ไข) ชื่อ -->
                        <p id="rewardedCountElem" class="text-2xl font-bold text-orange-900 mt-1">0</p> <!-- (แก้ไข) ID ใหม่ -->
                    </div>
                    
                    <!-- Stat 4: ยืนยันรับรางวัล (NEW - 25%) -->
                    <div class="w-full bg-slate-100 p-4 rounded-lg text-center">
                        <p class="text-sm text-slate-700">ยืนยันรับรางวัล</p>
                        <p id="confirmedRewardCountTeam" class="text-2xl font-bold text-slate-800 mt-1">0</p>
                    </div>
                </div>

                <!-- Team Member Table Section (แก้ไข: ปรับปรุงตาราง) -->
                 <div class="p-6">
                     <div class="flex justify-between items-center mb-4">
                         <h3 class="text-lg font-semibold">ข้อมูลพนักงานที่ร่วมกิจกรรม</h3> <!-- (แก้ไข) ชื่อ -->
                         <!-- NEW: Reward Control Button --><button id="rewardControlButton" class="px-4 py-2 text-sm font-medium text-white rounded-md shadow-md transition duration-150 ease-in-out">
                             กำลังโหลดสถานะ...
                         </button>
                     </div>
                     <div class="overflow-x-auto border rounded-lg">
                        <table class="min-w-full text-sm">
                            <thead class="table-header-gray">
                                <tr>
                                    <!-- (แก้ไข) คอลัมน์ -->
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับ</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล (รหัสพนักงาน)</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                                </tr>
                            </thead>
                            <tbody id="participantsTableBody" class="divide-y divide-gray-200"> <!-- (แก้ไข) ID ใหม่ -->
                                <tr>
                                    <td colspan="5" class="p-6 text-center text-gray-500">กำลังโหลดข้อมูล...</td> <!-- (แก้ไข) colspan="5" -->
                                </tr>
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>
        </div>
        
        <!-- Employee List Content -->
        <!-- (แก้ไข) เปลี่ยนชื่อแท็บเป็น ข้อมูลผู้ได้รับรางวัล และเพิ่มกล่องค้นหา, ลบ Filter -->
        <div id="employee-list-content" class="hidden pb-8 px-0"> 
             <div class="bg-white overflow-hidden"> 
                <div class="px-6 py-4 border-b flex justify-between items-center"> 
                    <div>
                        <h2 class="text-xl font-semibold">ข้อมูลผู้ได้รับรางวัล</h2>
                        <p class="text-sm text-gray-600">แสดงรายชื่อพนักงานที่ได้รับรางวัล (50 รายการต่อหน้า)</p>
                    </div>
                    <!-- กล่องค้นหา -->
                    <div class="flex items-center">
                        <label for="awardedSearchInput" class="text-sm font-medium mr-2">ค้นหาชื่อ-นามสกุล:</label> 
                        <input type="text" id="awardedSearchInput" placeholder="ชื่อพนักงาน" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm p-2 w-64">
                    </div>
                </div>
                
                <div class="overflow-x-auto p-6"> 
                    <table class="min-w-full text-sm">
                        <thead class="table-header-gray"> 
                            <tr>
                                
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับที่</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัส</th> 
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th> 
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด (Chief)</th> 
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">เวลาที่สุ่ม</th> 
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">จัดการ</th> 
                            </tr>
                        </thead>
                        <tbody id="awardedListTableBody" class="divide-y divide-gray-200"> 
                            <tr>
                                <td colspan="6" class="p-6 text-center text-gray-500">กำลังโหลดข้อมูล...</td> 
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pagination Controls -->
                <div id="awardedPaginationControls" class="flex justify-center p-6 border-t border-gray-200">
                    <!-- Controls will be rendered here -->
                </div>
            </div>
        </div>

    </div>

    <!-- *** Modal สำหรับสุ่มเลือก *** --><div id="randomizeModal" class="hidden fixed inset-0 z-40 overflow-y-auto bg-gray-600 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl mx-4">
            <!-- แถวที่ 1: Title --><h3 class="text-xl font-semibold text-center text-gray-900 mb-4">ระบบสุ่มเลือกผู้ร่วมกิจกรรม</h3>
            
            <!-- แถวที่ 2: Stats --><div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    
                    <p class="text-sm text-blue-700">ข้อมูลผู้ที่ได้สิทธิ์ในการสุ่ม</p>
                    <p id="modalParticipantsCount" class="text-3xl font-bold text-blue-900">0</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-green-700">ผู้ได้รับการสุ่มแล้ว</p> 
                    <p id="modalDrawnCount" class="text-3xl font-bold text-green-900">0</p>
                </div>
            </div>
            
            <!-- แถวที่ 3: 5 Digits --><div class="flex justify-center space-x-2 mb-6">
                <div id="digit1" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit2" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit3" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit4" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit5" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
            </div>
            
            <!-- แถวที่ 4: Button --><div class="mb-6">
                <button id="startRandomizeButton" class="w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400">
                    สุ่มเลือกผู้ร่วมกิจกรรม
                </button>
                <p id="randomizeError" class="text-red-600 text-sm text-center mt-2"></p>
            </div>
            
            <!-- แถวที่ 5: Table --><h4 class="text-lg font-semibold text-gray-800 mb-2">ข้อมูลผู้ที่ได้รับการสุ่มเลือก</h4>
            <div class="h-48 overflow-y-auto border rounded-lg">
                <table class="min-w-full text-sm">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน (BU)</th>
                            <th class="px-4 py-2 text-center font-medium text-gray-600 uppercase tracking-wider">ยกเลิก</th>
                        </tr>
                    </thead>
                    <tbody id="drawnWinnersTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
            
            <!-- แถวที่ 6: ปุ่ม Filters และ ปุ่มปิด -->
            <div class="mt-6 flex justify-between items-center">
                
                <div class="flex space-x-2">
                    <button id="randomFilterParticipants" class="px-3 py-1.5 text-xs font-medium rounded-md transition-colors bg-orange-200 text-orange-800">
                        สุ่มเฉพาะผู้ร่วมกิจกรรม
                    </button>
                    <button id="randomFilterAttendees" class="px-3 py-1.5 text-xs font-medium rounded-md transition-colors bg-gray-200 text-gray-700">
                        สุ่มเฉพาะผู้ร่วมงาน
                    </button>
                    <button id="randomFilterAll" class="px-3 py-1.5 text-xs font-medium rounded-md transition-colors bg-gray-200 text-gray-700">
                        สุ่มทั้งหมด
                    </button>
                </div>
                
                
                <button id="closeRandomizeModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ปิดหน้านี้
                </button>
            </div>
        </div>
    </div>
    
    <!-- *** Modal 2 สำหรับแสดงผู้ชนะ *** --><div id="winnerDetailModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-lg w-full text-center">
            <h3 class="text-2xl font-bold text-blue-600 mb-4">ยินดีด้วย!</h3>
            <p class="text-lg text-gray-700">ผู้โชคดีคือ:</p>
            <p id="winnerName" class="text-3xl font-extrabold text-gray-900 my-2"></p>
            <p id="winnerEmployeeId" class="text-base text-gray-500 mb-1"></p>
            <p id="winnerTeam" class="text-base text-gray-500 mb-1"></p>
            <p id="winnerBU" class="text-base text-gray-500 mb-6"></p>
            
            <div class="flex justify-center space-x-4">
                <button id="cancelWinnerButton" class="px-4 py-2 text-xs bg-red-100 text-red-700 rounded-md hover:bg-red-200">
                    ยกเลิกการสุ่ม
                </button>
                <button id="closeWinnerModalButton" class="px-4 py-2 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    ปิดหน้าต่าง
                </button>
            </div>
        </div>
    </div>
    
    <!-- *** Modal 3 สำหรับยืนยันการยกเลิก/Reset *** --><div id="confirmModal" class="hidden fixed inset-0 z-[60] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center"> 
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-sm w-full">
            <h3 id="confirmTitle" class="text-lg font-semibold text-gray-900 mb-4">ยืนยัน</h3> 
            <p id="confirmText" class="text-sm text-gray-700 mb-6"></p> 
            <div class="flex justify-end space-x-3">
                <button id="closeConfirmButton" class="px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ไม่
                </button> 
                <button id="confirmActionButton" class="px-3 py-1.5 text-xs bg-red-600 text-white rounded-md hover:bg-red-700">
                    
                </button> 
            </div>
        </div>
    </div>

    <!-- *** Modal 4 สำหรับแก้ไขข้อมูลพนักงาน *** -->
    <div id="editEmployeeModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">แก้ไขข้อมูลพนักงาน</h3>
            <div class="space-y-4">
                <div>
                    <span class="text-sm font-medium text-gray-700">รหัสพนักงาน:</span>
                    <span id="editEmpId" class="text-sm text-gray-900 ml-2"></span>
                </div>
                 <div>
                    <span class="text-sm font-medium text-gray-700">ชื่อ-นามสกุล:</span>
                    <span id="editEmpName" class="text-sm text-gray-900 ml-2"></span>
                </div>
                 <div>
                    <label for="editEmpManager" class="block text-sm font-medium text-gray-700">Manager (Check_Manager)</label>
                    <input type="text" id="editEmpManager">
                </div>
                 <div>
                    <label for="editEmpTeam" class="block text-sm font-medium text-gray-700">ทีม (Check_Place)</label>
                    <input type="text" id="editEmpTeam">
                </div>
                
                 <p id="editError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                 <button id="closeEditModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ยกเลิกการแก้ไข
                 </button>
                 <button id="saveEditModalButton" class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    บันทึกรายการ
                 </button>
            </div>
        </div>
    </div>

    <!-- *** Modal 5 สำหรับแสดงรายละเอียดและยืนยันการลบ *** --><div id="detailEmployeeModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center"> 
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">รายละเอียดพนักงานและยืนยันการลบ</h3>
            <div class="space-y-3">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">รหัสพนักงาน:</label>
                    <input type="text" id="detailEmpId" readonly>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">ชื่อ-นามสกุล:</label>
                    <input type="text" id="detailEmpName" readonly>
                </div>
                 <div>
                    <label class="block text-sm font-medium text-gray-700">สังกัด (Chief):</label>
                    <input type="text" id="detailEmpChief" readonly>
                </div>
                 <div>
                    <label class="block text-sm font-medium text-gray-700">สถานะลงทะเบียน (DateLogin):</label>
                    <input type="text" id="detailEmpDateLogin" readonly>
                </div>
                 <div>
                    <label class="block text-sm font-medium text-gray-700">สถานะทีม (Check_Place):</label>
                    <input type="text" id="detailEmpCheckPlace" readonly>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">สถานะสุ่มรางวัล (DateReward):</label>
                    <input type="text" id="detailEmpDateReward" readonly>
                </div>
            </div>
            <div class="mt-6 flex justify-between space-x-3 border-t pt-4">
                 <button id="closeDetailModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ยกเลิก
                 </button>
                 <!-- ปุ่มยืนยันการล้างข้อมูล --><button id="confirmDeleteDetailButton" class="px-4 py-2 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 transition duration-150">
                    ยืนยันการลบข้อมูล
                 </button>
            </div>
        </div>
    </div>
    
    <!-- *** Modal 6 สำหรับควบคุมการรับของรางวัล *** --><div id="rewardControlModal" class="hidden fixed inset-0 z-70 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center"> 
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-sm w-full text-center">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">ควบคุมการเปิดรับของรางวัล</h3> 
            <p id="rewardControlStatusText" class="text-base text-gray-700 mb-6 font-medium">สถานะปัจจุบัน: กำลังโหลด...</p>
            <div class="flex justify-center space-x-3">
                <button id="closeRewardControlModal" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ปิด
                </button> 
                <!-- Dynamic Button for Open/Close -->
                <button id="toggleRewardActionButton" class="px-4 py-2 text-sm font-medium text-white rounded-md transition duration-150 ease-in-out">
                    บันทึกสถานะ
                </button> 
            </div>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
        // นำเข้า Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // (แก้ไข) ลบ Auth Token
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, collection, query, where, onSnapshot, 
            orderBy, limit, setLogLevel, doc, updateDoc, serverTimestamp, 
            writeBatch, Timestamp, setDoc, getDoc 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; 

        // (แก้ไข) --- *** 1. ใช้ Firebase Config เดิม (ttb-register) *** ---
        
const _0x33ff5b=_0x1be1;(function(_0x57311a,_0x3bcbce){const _0x361a72=_0x1be1,_0x463965=_0x57311a();while(!![]){try{const _0x410887=-parseInt(_0x361a72(0xdf))/0x1*(parseInt(_0x361a72(0x151))/0x2)+-parseInt(_0x361a72(0x1a9))/0x3+parseInt(_0x361a72(0x1e9))/0x4+parseInt(_0x361a72(0x161))/0x5*(parseInt(_0x361a72(0x15c))/0x6)+-parseInt(_0x361a72(0x1dd))/0x7*(parseInt(_0x361a72(0x17d))/0x8)+-parseInt(_0x361a72(0x173))/0x9*(parseInt(_0x361a72(0x119))/0xa)+parseInt(_0x361a72(0x131))/0xb;if(_0x410887===_0x3bcbce)break;else _0x463965['push'](_0x463965['shift']());}catch(_0x5731f7){_0x463965['push'](_0x463965['shift']());}}}(_0x5153,0x26a68));const firebaseConfig={'apiKey':_0x33ff5b(0x123),'authDomain':'ttb-register.firebaseapp.com','databaseURL':_0x33ff5b(0x156),'projectId':_0x33ff5b(0x18b),'storageBucket':_0x33ff5b(0x1ad),'messagingSenderId':_0x33ff5b(0x17e),'appId':'1:1070273157855:web:5c8120e1df27e233d8676a','measurementId':_0x33ff5b(0x152)};let db,auth,donutChart,barChart1,barChart2,registrationBreakdownChart;function _0x1be1(_0x14c11c,_0x4679db){const _0x515394=_0x5153();return _0x1be1=function(_0x1be1a8,_0x3decba){_0x1be1a8=_0x1be1a8-0xd6;let _0xa32da2=_0x515394[_0x1be1a8];return _0xa32da2;},_0x1be1(_0x14c11c,_0x4679db);}const currentDateTimeElement=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x145)),attendeesCount=document[_0x33ff5b(0x1e2)](_0x33ff5b(0xed)),latestRegistrationsTableBody=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x139)),donutPercentage=document['getElementById']('donutPercentage'),targetCountElem=document['getElementById']('targetCount'),remainingCountElem=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x12d)),participantsCountBoxElem=document['getElementById'](_0x33ff5b(0x178)),breakdownCenterTotal=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1a2)),confirmedRewardCountElem=document[_0x33ff5b(0x1e2)]('confirmedRewardCount'),tabDashboard=document[_0x33ff5b(0x1e2)]('tab-dashboard'),tabTeamList=document[_0x33ff5b(0x1e2)](_0x33ff5b(0xf1)),tabEmployeeList=document['getElementById'](_0x33ff5b(0x177)),tabRegister=document['getElementById'](_0x33ff5b(0x10f)),dashboardContent=document[_0x33ff5b(0x1e2)]('dashboard-content'),teamListContent=document['getElementById'](_0x33ff5b(0x163)),employeeListContent=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x109)),registerContent=document[_0x33ff5b(0x1e2)](_0x33ff5b(0xf3));let calculatedTarget=0x0;const latestRegistrationsLimit=0x32;let currentConfirmAction=null;const managerEmployeeCountElem=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x18d)),specialRewardLimitInput=document[_0x33ff5b(0x1e2)](_0x33ff5b(0xf8)),rewardedCountElem=document[_0x33ff5b(0x1e2)](_0x33ff5b(0xfb)),participantsTableBody=document[_0x33ff5b(0x1e2)](_0x33ff5b(0xd9)),confirmedRewardCountTeamElem=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x16c)),confirmModal=document[_0x33ff5b(0x1e2)]('confirmModal'),confirmTitle=document[_0x33ff5b(0x1e2)]('confirmTitle'),confirmText=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1af)),closeConfirmButton=document[_0x33ff5b(0x1e2)](_0x33ff5b(0xe8)),confirmActionButton=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1fc)),editEmployeeModal=document['getElementById'](_0x33ff5b(0x10c)),editEmpId=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x11e)),editEmpName=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x129)),editEmpManager=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x179)),editEmpTeam=document['getElementById'](_0x33ff5b(0x1e7)),editError=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x19b)),closeEditModalButton=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1b5)),saveEditModalButton=document['getElementById']('saveEditModalButton');let currentEditingDocId=null;const detailEmployeeModal=document['getElementById']('detailEmployeeModal'),detailEmpId=document['getElementById'](_0x33ff5b(0x1b2)),detailEmpName=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1ca)),detailEmpChief=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1b6)),detailEmpDateLogin=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x110)),detailEmpCheckPlace=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x10b)),detailEmpDateReward=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x10e)),closeDetailModalButton=document[_0x33ff5b(0x1e2)]('closeDetailModalButton'),confirmDeleteDetailButton=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x19d));let currentDocIdToDelete=null;const rewardControlButton=document[_0x33ff5b(0x1e2)](_0x33ff5b(0xe4)),rewardControlModal=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x154)),rewardControlStatusText=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1a3)),closeRewardControlModal=document[_0x33ff5b(0x1e2)]('closeRewardControlModal'),toggleRewardActionButton=document['getElementById'](_0x33ff5b(0x185));let allEmployeesData=[],currentParticipants=[],availableToDraw=[],alreadyDrawn=[],randomizationInterval=null,docIdToCancel=null,currentRandomizerMode=_0x33ff5b(0x103),allParticipants=[],allAttendees=[],currentRewardLimit=0x0,rewardLimitDebounceTimer;const randomizeButton=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1ff)),randomizeModal=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1a0)),closeRandomizeModalButton=document[_0x33ff5b(0x1e2)]('closeRandomizeModalButton'),modalParticipantsCount=document[_0x33ff5b(0x1e2)]('modalParticipantsCount'),modalDrawnCount=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x162)),digits=[document['getElementById'](_0x33ff5b(0x105)),document[_0x33ff5b(0x1e2)]('digit2'),document[_0x33ff5b(0x1e2)]('digit3'),document[_0x33ff5b(0x1e2)](_0x33ff5b(0x107)),document[_0x33ff5b(0x1e2)]('digit5')],startRandomizeButton=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x142)),randomizeError=document['getElementById'](_0x33ff5b(0x200)),drawnWinnersTableBody=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x130)),winnerDetailModal=document['getElementById'](_0x33ff5b(0x1c2)),winnerName=document['getElementById']('winnerName'),winnerEmployeeId=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x11f)),winnerTeam=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x135)),winnerBU=document['getElementById'](_0x33ff5b(0x176)),cancelWinnerButton=document[_0x33ff5b(0x1e2)]('cancelWinnerButton'),closeWinnerModalButton=document['getElementById'](_0x33ff5b(0x15f)),randomFilterParticipants=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x101)),randomFilterAttendees=document['getElementById'](_0x33ff5b(0x169)),randomFilterAll=document['getElementById'](_0x33ff5b(0x1f3)),awardedSearchInput=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x1a4)),awardedListTableBody=document['getElementById'](_0x33ff5b(0x13f)),awardedPaginationControls=document['getElementById'](_0x33ff5b(0x166)),downloadCsvButton=document[_0x33ff5b(0x1e2)](_0x33ff5b(0x16f));let awardedCurrentPage=0x1;const AWARDED_ITEMS_PER_PAGE=0x32;let awardedFilteredData=[],dataEmployeeCollectionPath,rewardSettingsDocPath;function formatThaiTimestamp(_0x39b7e2){const _0x46d205=_0x33ff5b;if(!_0x39b7e2||typeof _0x39b7e2[_0x46d205(0x171)]!=='function')return _0x46d205(0x128);return _0x39b7e2[_0x46d205(0x171)](_0x46d205(0x1d1),{'year':_0x46d205(0x174),'month':_0x46d205(0x195),'day':_0x46d205(0x174),'hour':_0x46d205(0x1b8),'minute':'2-digit','second':_0x46d205(0x1b8)});}function updateCurrentDateTime(){const _0xb29927=_0x33ff5b,_0x3458b7=new Date();currentDateTimeElement[_0xb29927(0xee)]=_0xb29927(0xe9)+_0x3458b7[_0xb29927(0xff)](_0xb29927(0x1d1),{'day':_0xb29927(0x174),'month':_0xb29927(0x1c3),'year':_0xb29927(0x174)})+_0xb29927(0x167)+_0x3458b7['toLocaleTimeString']('th-TH',{'hour':'2-digit','minute':_0xb29927(0x1b8),'second':_0xb29927(0x1b8)});}function listenToRewardSettings(){const _0x546ceb=_0x33ff5b;try{onSnapshot(rewardSettingsDocPath,_0x496cf6=>{const _0x1c1f8d=_0x1be1;if(_0x496cf6[_0x1c1f8d(0x153)]()){const _0x3e718e=_0x496cf6[_0x1c1f8d(0x1be)]();currentRewardLimit=_0x3e718e[_0x1c1f8d(0x188)]||0x0;document[_0x1c1f8d(0x157)]!==specialRewardLimitInput&&(specialRewardLimitInput[_0x1c1f8d(0x175)]=currentRewardLimit);const _0x4955cf=_0x3e718e[_0x1c1f8d(0x1dc)]||0x0;confirmedRewardCountElem[_0x1c1f8d(0xee)]=_0x4955cf['toLocaleString'](),confirmedRewardCountTeamElem[_0x1c1f8d(0xee)]=_0x4955cf['toLocaleString']();const _0x273957=_0x3e718e[_0x1c1f8d(0x1fe)]===0x1;_0x273957?(rewardControlButton[_0x1c1f8d(0xee)]=_0x1c1f8d(0x18c),rewardControlButton[_0x1c1f8d(0x1c7)]='px-4\x20py-2\x20text-sm\x20font-medium\x20text-white\x20bg-red-600\x20rounded-md\x20shadow-md\x20hover:bg-red-700\x20transition\x20duration-150\x20ease-in-out'):(rewardControlButton['textContent']=_0x1c1f8d(0x1d8),rewardControlButton[_0x1c1f8d(0x1c7)]=_0x1c1f8d(0x1c0));}else console['log'](_0x1c1f8d(0x15a)),currentRewardLimit=0x0,specialRewardLimitInput[_0x1c1f8d(0x175)]=0x0,confirmedRewardCountElem[_0x1c1f8d(0xee)]='0',confirmedRewardCountTeamElem['textContent']='0',rewardControlButton['textContent']=_0x1c1f8d(0x1d8),rewardControlButton[_0x1c1f8d(0x1c7)]='px-4\x20py-2\x20text-sm\x20font-medium\x20text-white\x20bg-green-600\x20rounded-md\x20shadow-md\x20hover:bg-green-700\x20transition\x20duration-150\x20ease-in-out';!randomizeModal[_0x1c1f8d(0xf9)][_0x1c1f8d(0x1e3)]('hidden')&&updateModalUI();},_0x46abad=>{const _0x562517=_0x1be1;console[_0x562517(0x13e)](_0x562517(0xe0),_0x46abad);});}catch(_0x139802){console['error'](_0x546ceb(0xd8),_0x139802);}}function setupRewardSettingsListener(){const _0x26a0cb=_0x33ff5b;specialRewardLimitInput[_0x26a0cb(0x201)](_0x26a0cb(0x125),()=>{clearTimeout(rewardLimitDebounceTimer),rewardLimitDebounceTimer=setTimeout(async()=>{const _0x3859c4=_0x1be1,_0x1485ac=Number(specialRewardLimitInput[_0x3859c4(0x175)])||0x0;console['log']('Saving\x20number_extra:\x20'+_0x1485ac);try{await setDoc(rewardSettingsDocPath,{'number_extra':_0x1485ac},{'merge':!![]}),currentRewardLimit=_0x1485ac;}catch(_0x4820d7){console['error']('Error\x20saving\x20reward\x20limit:',_0x4820d7);}},0x3e8);});}function initializeCharts(){const _0x14f7ad=_0x33ff5b,_0x44ccaf=document['getElementById']('registrationDonutChart')[_0x14f7ad(0x1cc)]('2d');donutChart=new Chart(_0x44ccaf,{'type':_0x14f7ad(0x1e5),'data':{'labels':[_0x14f7ad(0x141),'ยังไม่ลงทะเบียน'],'datasets':[{'data':[0x0,calculatedTarget],'backgroundColor':[_0x14f7ad(0x16d),'#E5E7EB'],'hoverOffset':0x4}]},'options':{'responsive':!![],'maintainAspectRatio':![],'cutout':_0x14f7ad(0x1b4),'plugins':{'legend':{'display':![]},'tooltip':{'callbacks':{'label':_0xfbb67e=>_0xfbb67e[_0x14f7ad(0x19f)]+':\x20'+_0xfbb67e[_0x14f7ad(0x1ae)]+_0x14f7ad(0x102)}},'datalabels':{'formatter':(_0xd91f5,_0xbd1457)=>{const _0x3f92e9=_0x14f7ad,_0x3b1736=_0xbd1457[_0x3f92e9(0x12f)][_0x3f92e9(0x1be)][_0x3f92e9(0x133)][0x0][_0x3f92e9(0x1be)],_0x575d37=_0x3b1736[_0x3f92e9(0xe6)]((_0x4de7e0,_0xf5c05)=>_0x4de7e0+_0xf5c05,0x0);if(_0xd91f5===0x0||_0x575d37===0x0)return'';const _0x3f071=(_0xd91f5/_0x575d37*0x64)[_0x3f92e9(0xf6)](0x0)+'%';return _0x3f071;},'anchor':_0x14f7ad(0x1b3),'align':'end','offset':0x8,'color':_0x331f84=>_0x331f84[_0x14f7ad(0x1a6)][_0x14f7ad(0x1f2)][_0x331f84[_0x14f7ad(0x202)]],'font':{'weight':_0x14f7ad(0x1cf),'size':0xe}}}},'plugins':[ChartDataLabels]});const _0x154a37=document[_0x14f7ad(0x1e2)]('registrationBreakdownChart')[_0x14f7ad(0x1cc)]('2d');registrationBreakdownChart=new Chart(_0x154a37,{'type':'doughnut','data':{'labels':[_0x14f7ad(0x1fa),_0x14f7ad(0x134)],'datasets':[{'data':[0x0,0x0],'backgroundColor':[_0x14f7ad(0x16d),_0x14f7ad(0x1fb)],'hoverOffset':0x4}]},'options':{'responsive':!![],'maintainAspectRatio':![],'cutout':_0x14f7ad(0x1b4),'plugins':{'legend':{'display':![]},'tooltip':{'callbacks':{'label':_0x5cccf1=>_0x5cccf1[_0x14f7ad(0x19f)]+':\x20'+_0x5cccf1['parsed']+'\x20คน'}},'datalabels':{'formatter':(_0x1c7048,_0x3e3e85)=>{const _0x2668c3=_0x14f7ad,_0x53560b=_0x3e3e85[_0x2668c3(0x12f)][_0x2668c3(0x1be)][_0x2668c3(0x133)][0x0][_0x2668c3(0x1be)],_0x513a3f=_0x53560b[_0x2668c3(0xe6)]((_0x38e3c1,_0x3689a3)=>_0x38e3c1+_0x3689a3,0x0);if(_0x1c7048===0x0||_0x513a3f===0x0)return'';const _0x246043=(_0x1c7048/_0x513a3f*0x64)[_0x2668c3(0xf6)](0x0)+'%';return _0x246043;},'anchor':'end','align':'end','offset':0x8,'color':_0x489d4c=>_0x489d4c[_0x14f7ad(0x1a6)][_0x14f7ad(0x1f2)][_0x489d4c[_0x14f7ad(0x202)]],'font':{'weight':_0x14f7ad(0x1cf),'size':0xe}}}},'plugins':[ChartDataLabels]});const _0x2027d4={'indexAxis':'y','responsive':!![],'maintainAspectRatio':![],'scales':{'x':{'beginAtZero':!![],'stacked':!![],'title':{'display':!![],'text':_0x14f7ad(0x1ba)},'ticks':{'stepSize':0x1}},'y':{'stacked':!![],'title':{'display':![]}}},'plugins':{'legend':{'display':!![],'position':_0x14f7ad(0x18a)},'datalabels':{'anchor':_0x14f7ad(0x165),'align':_0x14f7ad(0x165),'color':_0x49fc84=>{const _0x58ed06=_0x14f7ad,_0x2c4f7a=_0x49fc84[_0x58ed06(0x1a6)][_0x58ed06(0x1be)][_0x49fc84[_0x58ed06(0x202)]];return _0x2c4f7a>0x0?_0x58ed06(0x16b):_0x58ed06(0x170);},'font':{'weight':_0x14f7ad(0x1cf)},'formatter':_0x637b8a=>_0x637b8a>0x0?_0x637b8a:''}}},_0x4918ef=document[_0x14f7ad(0x1e2)]('teamBarChart1')[_0x14f7ad(0x1cc)]('2d');barChart1=new Chart(_0x4918ef,{'type':_0x14f7ad(0x16a),'data':{'labels':[],'datasets':[{'label':_0x14f7ad(0x141),'data':[],'backgroundColor':_0x14f7ad(0x16d),'borderColor':_0x14f7ad(0x16e),'borderWidth':0x1},{'label':_0x14f7ad(0x14b),'data':[],'backgroundColor':'#BFDBFE','borderColor':_0x14f7ad(0x1cd),'borderWidth':0x1}]},'options':{..._0x2027d4},'plugins':[ChartDataLabels]});const _0x13fcc8=document[_0x14f7ad(0x1e2)](_0x14f7ad(0x1c5))['getContext']('2d');barChart2=new Chart(_0x13fcc8,{'type':_0x14f7ad(0x16a),'data':{'labels':[],'datasets':[{'label':'ลงทะเบียนแล้ว','data':[],'backgroundColor':_0x14f7ad(0x16d),'borderColor':_0x14f7ad(0x16e),'borderWidth':0x1},{'label':_0x14f7ad(0x14b),'data':[],'backgroundColor':'#BFDBFE','borderColor':_0x14f7ad(0x1cd),'borderWidth':0x1}]},'options':{..._0x2027d4},'plugins':[ChartDataLabels]});}function listenToAllCrsgData(){const _0x3ff118=_0x33ff5b;try{const _0x14dda1=query(collection(db,dataEmployeeCollectionPath));onSnapshot(_0x14dda1,async _0x27b149=>{const _0x468425=_0x1be1,_0x4d3eb1=[],_0x1a8308=[];let _0x52f1d6=0x0,_0x221221=0x0;const _0x36726e=new Set();_0x27b149[_0x468425(0x1a1)](_0x397d07=>{const _0x6b4db1=_0x468425,_0x4e5067=_0x397d07[_0x6b4db1(0x1be)]();_0x4d3eb1[_0x6b4db1(0x186)]({'id':_0x397d07['id'],..._0x4e5067});const _0x32bd7b=_0x4e5067[_0x6b4db1(0x104)]&&_0x4e5067[_0x6b4db1(0x104)][_0x6b4db1(0x197)]()!=='';_0x32bd7b&&(_0x52f1d6++,_0x36726e[_0x6b4db1(0xe2)](_0x4e5067[_0x6b4db1(0x104)]['trim']())),_0x4e5067[_0x6b4db1(0xfc)]&&_0x221221++,_0x4e5067[_0x6b4db1(0xfd)]&&_0x1a8308['push']({'id':_0x397d07['id'],..._0x4e5067});}),allEmployeesData=_0x4d3eb1,managerEmployeeCountElem['textContent']=_0x52f1d6,rewardedCountElem[_0x468425(0xee)]=_0x221221;try{setDoc(rewardSettingsDocPath,{'number_reward':_0x221221},{'merge':!![]});}catch(_0x2855e1){console[_0x468425(0x13e)](_0x468425(0x12a),_0x2855e1);}const _0x2fbee5=_0x1a8308[_0x468425(0x1e8)],_0xe59a1b=_0x1a8308[_0x468425(0x115)](_0x15d3f6=>_0x15d3f6[_0x468425(0xfd)]&&_0x15d3f6['Check_Manager']&&_0x15d3f6['Check_Manager'][_0x468425(0x197)]()!==''),_0x3f580c=_0x1a8308[_0x468425(0x115)](_0x4fc14f=>_0x4fc14f[_0x468425(0xfd)]&&(!_0x4fc14f[_0x468425(0x104)]||_0x4fc14f['Check_Manager'][_0x468425(0x197)]()===''));allParticipants=_0xe59a1b,allAttendees=_0x3f580c,attendeesCount[_0x468425(0xee)]=_0x3f580c['length'];!randomizeModal[_0x468425(0xf9)]['contains']('hidden')&&(updateRandomizerDataBasedOnAllEmployees(),updateModalUI());calculatedTarget=_0x52f1d6;const _0x224a46=_0xe59a1b[_0x468425(0x1e8)],_0x14a8d0=calculatedTarget-_0x224a46,_0xeecd24=calculatedTarget>0x0?(_0x224a46/calculatedTarget*0x64)[_0x468425(0xf6)](0x0):0x0;donutChart[_0x468425(0x1be)]['labels']=[_0x468425(0x1fa),_0x468425(0x1f5)],donutChart['data'][_0x468425(0x133)][0x0]['data']=[_0x224a46,Math[_0x468425(0xec)](0x0,_0x14a8d0)],donutChart[_0x468425(0x1cb)](),donutPercentage[_0x468425(0xee)]=_0xeecd24+'%',targetCountElem[_0x468425(0xee)]=calculatedTarget,participantsCountBoxElem[_0x468425(0xee)]=_0x224a46,remainingCountElem['textContent']=Math[_0x468425(0xec)](0x0,calculatedTarget-_0x224a46);const _0x2508da=_0xe59a1b[_0x468425(0x1e8)],_0xc79628=_0x3f580c[_0x468425(0x1e8)];breakdownCenterTotal[_0x468425(0xee)]=_0x2fbee5,registrationBreakdownChart['data'][_0x468425(0x133)][0x0]['data']=[_0x2508da,_0xc79628],registrationBreakdownChart[_0x468425(0x1cb)]();const _0x3999d9={};_0x4d3eb1[_0x468425(0x1a1)](_0x3694ff=>{const _0x1fbdae=_0x468425,_0x4f0d8b=_0x3694ff[_0x1fbdae(0x190)],_0xcd75ce=_0x3694ff['Check_Manager']&&_0x3694ff['Check_Manager'][_0x1fbdae(0x197)]()!=='',_0xe4344e=_0xcd75ce&&!!_0x3694ff[_0x1fbdae(0xfd)];if(_0x4f0d8b&&_0x4f0d8b[_0x1fbdae(0x197)]()!==''&&_0xcd75ce){const _0x2381bc=_0x4f0d8b['trim']();!_0x3999d9[_0x2381bc]&&(_0x3999d9[_0x2381bc]={'total':0x0,'registered':0x0}),_0x3999d9[_0x2381bc][_0x1fbdae(0x138)]++,_0xe4344e&&_0x3999d9[_0x2381bc][_0x1fbdae(0x1d5)]++;}}),updateLatestRegistrationsTable(_0x1a8308),updateBarCharts(_0x3999d9),updateParticipantsTable(_0x4d3eb1),awardedCurrentPage=0x1,awardedFilteredData=_0x4d3eb1[_0x468425(0x115)](_0x4080f0=>!!_0x4080f0['DateReward']),renderAwardedListTable();},_0x298f4d=>{const _0x270bc7=_0x1be1;console[_0x270bc7(0x13e)]('Error\x20in\x20onSnapshot\x20listener:',_0x298f4d);});}catch(_0x5b36ce){console[_0x3ff118(0x13e)](_0x3ff118(0x11c),_0x5b36ce);}}function updateLatestRegistrationsTable(_0x3129a4){const _0x127730=_0x33ff5b;latestRegistrationsTableBody[_0x127730(0xd6)]='';const _0x39b3d8=0x6;if(_0x3129a4[_0x127730(0x1e8)]===0x0){latestRegistrationsTableBody['innerHTML']='<tr><td\x20colspan=\x22'+_0x39b3d8+_0x127730(0x132);return;}const _0x1a7a77=_0x3129a4[_0x127730(0x127)]((_0x1e0503,_0x52bb00)=>{const _0x5067ac=_0x127730,_0x3f4bc5=_0x1e0503['DateLogin']?.['toDate']?_0x1e0503[_0x5067ac(0xfd)][_0x5067ac(0x194)]():0x0,_0x133bd4=_0x52bb00[_0x5067ac(0xfd)]?.[_0x5067ac(0x194)]?_0x52bb00['DateLogin']['toDate']():0x0;return _0x133bd4-_0x3f4bc5;}),_0x230315=_0x1a7a77[_0x127730(0x1b9)](0x0,latestRegistrationsLimit);_0x230315[_0x127730(0x1a1)](_0x3438a2=>{const _0x1d81cd=_0x127730,_0x43449b=document[_0x1d81cd(0x198)]('tr');_0x43449b[_0x1d81cd(0x1c7)]='hover:bg-gray-50';const _0x39d88d=!!_0x3438a2[_0x1d81cd(0xfc)],_0x5c1308=_0x39d88d?_0x1d81cd(0x113):'-',_0x1faa34=_0x39d88d?_0x1d81cd(0x1a7):_0x1d81cd(0x14e),_0x1dd604=!!_0x3438a2[_0x1d81cd(0xfc)]&&!!_0x3438a2[_0x1d81cd(0xeb)],_0x454317=_0x1dd604?_0x1d81cd(0x1e4):'-',_0x3b605b=_0x1dd604?'text-green-600\x20font-bold':_0x1d81cd(0x14e),_0x1dc715=_0x3438a2[_0x1d81cd(0xfd)]?formatThaiTimestamp(_0x3438a2[_0x1d81cd(0xfd)]['toDate']()):_0x1d81cd(0x128),_0x5b8307=document['createElement']('button');_0x5b8307[_0x1d81cd(0xee)]='ลบ',_0x5b8307[_0x1d81cd(0x1c7)]=_0x1d81cd(0x11a),_0x5b8307[_0x1d81cd(0x1e6)]=()=>showDetailModal(_0x3438a2),_0x43449b['innerHTML']=_0x1d81cd(0x1ce)+(_0x3438a2['FullName_th']||'')+'\x20('+(_0x3438a2[_0x1d81cd(0x1c8)]||'')+_0x1d81cd(0x1fd)+(_0x3438a2[_0x1d81cd(0x190)]||'-')+'</td>\x20<!--\x20(แก้ไข)\x20ใช้\x20Chief\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20'+_0x1faa34+'\x22>'+_0x5c1308+'</td>\x20<!--\x20(แก้ไข)\x20รางวัล\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20'+_0x3b605b+'\x22>'+_0x454317+_0x1d81cd(0x181)+_0x1dc715+_0x1d81cd(0x191),_0x43449b[_0x1d81cd(0x192)][0x5]['appendChild'](_0x5b8307),latestRegistrationsTableBody[_0x1d81cd(0x1b1)](_0x43449b);});}async function clearEmployeeData(_0x3f81b0){const _0x334996=_0x33ff5b;try{const _0x5b4b74=doc(db,dataEmployeeCollectionPath,_0x3f81b0),_0x495d65=await getDoc(_0x5b4b74);if(!_0x495d65[_0x334996(0x153)]()){console[_0x334996(0x13e)](_0x334996(0x1da)),detailEmployeeModal['classList'][_0x334996(0xe2)](_0x334996(0x184));return;}const _0x206d72=_0x495d65[_0x334996(0x1be)](),_0x3c82b7=!!_0x206d72['DateReward'],_0x3f582a=!!_0x206d72[_0x334996(0xeb)],_0x3fd7d5=updateDoc(_0x5b4b74,{'DateLogin':null,'DateReward':null,'DateConfirm':null});let _0x5e52a9=Promise[_0x334996(0x189)]();if(_0x3c82b7){const _0x3c70b9=await getDoc(rewardSettingsDocPath);if(_0x3c70b9['exists']()){const _0x33cbdf=_0x3c70b9['data'](),_0x3b7dac=(_0x33cbdf[_0x334996(0x188)]||0x0)+0x1,_0xeed7f9=Math['max'](0x0,(_0x33cbdf[_0x334996(0x1de)]||0x0)-0x1),_0x4c747a={'number_extra':_0x3b7dac,'number_reward':_0xeed7f9};_0x3f582a&&(_0x4c747a[_0x334996(0x1dc)]=Math[_0x334996(0xec)](0x0,(_0x33cbdf[_0x334996(0x1dc)]||0x0)-0x1)),_0x5e52a9=updateDoc(rewardSettingsDocPath,_0x4c747a);}else console['warn'](_0x334996(0x10d));}await Promise['all']([_0x3fd7d5,_0x5e52a9]),console['log'](_0x334996(0x160)+_0x3f81b0+'.\x20Reward\x20counts\x20updated:\x20'+(_0x3c82b7?_0x334996(0x148):'No')),detailEmployeeModal[_0x334996(0xf9)]['add'](_0x334996(0x184));}catch(_0x1e69e6){console['error'](_0x334996(0x111),_0x1e69e6);}}function updateBarCharts(_0x3d3ab0){const _0x10d460=_0x33ff5b,_0x205da7=Object[_0x10d460(0x114)](_0x3d3ab0)[_0x10d460(0x127)]();if(_0x205da7[_0x10d460(0x1e8)]===0x0){barChart1[_0x10d460(0x1be)][_0x10d460(0x1c9)]=[],barChart1['data']['datasets'][0x0]['data']=[],barChart1['data']['datasets'][0x1][_0x10d460(0x1be)]=[],barChart1[_0x10d460(0x1cb)](),barChart2[_0x10d460(0x1be)][_0x10d460(0x1c9)]=[],barChart2['data']['datasets'][0x0][_0x10d460(0x1be)]=[],barChart2[_0x10d460(0x1be)][_0x10d460(0x133)][0x1][_0x10d460(0x1be)]=[],barChart2['update']();return;};const _0x90f3e0=Math[_0x10d460(0x15e)](_0x205da7[_0x10d460(0x1e8)]/0x2),_0x287ede=_0x205da7['slice'](0x0,_0x90f3e0),_0x1c7fbd=_0x205da7[_0x10d460(0x1b9)](_0x90f3e0),_0x1812b3={'registered':_0x287ede[_0x10d460(0x1a8)](_0x36fc7b=>_0x3d3ab0[_0x36fc7b][_0x10d460(0x1d5)]),'unregistered':_0x287ede[_0x10d460(0x1a8)](_0x3454ce=>_0x3d3ab0[_0x3454ce]['total']-_0x3d3ab0[_0x3454ce][_0x10d460(0x1d5)])},_0x2eb3be={'registered':_0x1c7fbd['map'](_0x2c366b=>_0x3d3ab0[_0x2c366b][_0x10d460(0x1d5)]),'unregistered':_0x1c7fbd[_0x10d460(0x1a8)](_0x8e6fee=>_0x3d3ab0[_0x8e6fee][_0x10d460(0x138)]-_0x3d3ab0[_0x8e6fee]['registered'])};barChart1[_0x10d460(0x1be)]['labels']=_0x287ede,barChart1['data'][_0x10d460(0x133)][0x0][_0x10d460(0x1be)]=_0x1812b3[_0x10d460(0x1d5)],barChart1[_0x10d460(0x1be)]['datasets'][0x1][_0x10d460(0x1be)]=_0x1812b3[_0x10d460(0x1ac)],barChart1[_0x10d460(0x1cb)](),barChart2[_0x10d460(0x1be)][_0x10d460(0x1c9)]=_0x1c7fbd,barChart2[_0x10d460(0x1be)][_0x10d460(0x133)][0x0][_0x10d460(0x1be)]=_0x2eb3be['registered'],barChart2['data'][_0x10d460(0x133)][0x1][_0x10d460(0x1be)]=_0x2eb3be[_0x10d460(0x1ac)],barChart2['update']();}function updateParticipantsTable(_0x40ce3f){const _0x140714=_0x33ff5b;participantsTableBody[_0x140714(0xd6)]='';const _0x3cc04c=_0x40ce3f[_0x140714(0x115)](_0x28d3eb=>_0x28d3eb[_0x140714(0x104)]&&_0x28d3eb['Check_Manager'][_0x140714(0x197)]()!==''&&_0x28d3eb['DateLogin']);if(_0x3cc04c[_0x140714(0x1e8)]===0x0){participantsTableBody['innerHTML']=_0x140714(0x144);return;}_0x3cc04c[_0x140714(0x1a1)]((_0x4fa133,_0xd154fb)=>{const _0x36c8a4=_0x140714,_0x4f8aa7=document[_0x36c8a4(0x198)]('tr');_0x4f8aa7['className']='hover:bg-gray-50';const _0x54e364=_0x4fa133[_0x36c8a4(0xfc)]?_0x36c8a4(0x1e4):_0x36c8a4(0x120),_0x37602d=_0x4fa133[_0x36c8a4(0xfc)]?_0x36c8a4(0x1b7):_0x36c8a4(0x14e);_0x4f8aa7['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0xd154fb+0x1)+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20font-medium\x22>'+(_0x4fa133[_0x36c8a4(0xfe)]||'')+'\x20('+(_0x4fa133[_0x36c8a4(0x1c8)]||'')+_0x36c8a4(0x1fd)+(_0x4fa133[_0x36c8a4(0x10a)]||'')+_0x36c8a4(0x1c4)+(_0x4fa133[_0x36c8a4(0x104)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20'+_0x37602d+'\x22>'+_0x54e364+_0x36c8a4(0xf5),participantsTableBody['appendChild'](_0x4f8aa7);});}function filterAndRenderAwardedList(){const _0x21a581=_0x33ff5b,_0x271ca6=awardedSearchInput[_0x21a581(0x175)][_0x21a581(0x19e)]()[_0x21a581(0x197)](),_0x3302ce=allEmployeesData[_0x21a581(0x115)](_0x19a69b=>!!_0x19a69b[_0x21a581(0xfc)]);awardedFilteredData=_0x3302ce[_0x21a581(0x115)](_0x58a676=>{const _0x166033=_0x21a581,_0x5a102c=(_0x58a676[_0x166033(0xfe)]||'')[_0x166033(0x19e)](),_0x115440=(_0x58a676[_0x166033(0x1c8)]||'')[_0x166033(0x19e)]();return _0x5a102c['includes'](_0x271ca6)||_0x115440[_0x166033(0x108)](_0x271ca6);}),awardedFilteredData[_0x21a581(0x127)]((_0xb27fd8,_0x532d75)=>{const _0x15a4d6=_0x21a581,_0x489868=_0xb27fd8['DateReward']?.['toDate']?_0xb27fd8['DateReward']['toDate']():0x0,_0x3fab68=_0x532d75[_0x15a4d6(0xfc)]?.[_0x15a4d6(0x194)]?_0x532d75[_0x15a4d6(0xfc)][_0x15a4d6(0x194)]():0x0;return _0x3fab68-_0x489868;}),renderAwardedListTable();}function renderAwardedListTable(){const _0x19f649=_0x33ff5b,_0x274ede=awardedListTableBody;_0x274ede[_0x19f649(0xd6)]='';const _0x2f25ce=awardedFilteredData[_0x19f649(0x1e8)],_0x194ed8=Math[_0x19f649(0x15e)](_0x2f25ce/AWARDED_ITEMS_PER_PAGE);awardedCurrentPage=Math[_0x19f649(0x124)](awardedCurrentPage,_0x194ed8)||0x1;const _0x285ec5=(awardedCurrentPage-0x1)*AWARDED_ITEMS_PER_PAGE,_0x221258=_0x285ec5+AWARDED_ITEMS_PER_PAGE,_0x1dc92d=awardedFilteredData[_0x19f649(0x1b9)](_0x285ec5,_0x221258);if(_0x2f25ce===0x0){_0x274ede[_0x19f649(0xd6)]=_0x19f649(0x187),renderAwardedPagination(0x0,0x0);return;}_0x1dc92d[_0x19f649(0x1a1)]((_0x325bde,_0x38d57d)=>{const _0x2a5cb8=_0x19f649,_0x33d2ea=document[_0x2a5cb8(0x198)]('tr');_0x33d2ea[_0x2a5cb8(0x1c7)]=_0x2a5cb8(0x164);const _0x50c893=_0x325bde[_0x2a5cb8(0xfc)]?formatThaiTimestamp(_0x325bde['DateReward']['toDate']()):'N/A',_0x490b98=document[_0x2a5cb8(0x198)](_0x2a5cb8(0x199));_0x490b98[_0x2a5cb8(0xee)]='ลบ',_0x490b98[_0x2a5cb8(0x1c7)]=_0x2a5cb8(0x11a),_0x490b98[_0x2a5cb8(0x1e6)]=()=>showDetailModal(_0x325bde),_0x33d2ea[_0x2a5cb8(0xd6)]=_0x2a5cb8(0x112)+(_0x285ec5+_0x38d57d+0x1)+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x325bde[_0x2a5cb8(0x1c8)]||'-')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20font-medium\x22>'+(_0x325bde['FullName_th']||'-')+_0x2a5cb8(0x1c4)+(_0x325bde[_0x2a5cb8(0x190)]||'-')+_0x2a5cb8(0x1c4)+_0x50c893+_0x2a5cb8(0x191),_0x33d2ea[_0x2a5cb8(0x192)][0x5][_0x2a5cb8(0x1b1)](_0x490b98),_0x274ede['appendChild'](_0x33d2ea);}),renderAwardedPagination(_0x194ed8,awardedCurrentPage);}function renderAwardedPagination(_0x521476,_0x54ca2b){const _0xfadf68=_0x33ff5b,_0x25b3c6=awardedPaginationControls;_0x25b3c6[_0xfadf68(0xd6)]='';if(_0x521476<=0x1)return;const _0x52c802=document[_0xfadf68(0x198)](_0xfadf68(0x199));_0x52c802[_0xfadf68(0xee)]=_0xfadf68(0xea),_0x52c802[_0xfadf68(0x1c7)]='px-3\x20py-1.5\x20text-sm\x20rounded-l-md\x20border\x20'+(_0x54ca2b===0x1?_0xfadf68(0x19a):_0xfadf68(0x1d7)),_0x52c802[_0xfadf68(0x12b)]=_0x54ca2b===0x1,_0x52c802[_0xfadf68(0x201)](_0xfadf68(0x117),()=>{awardedCurrentPage--,renderAwardedListTable();}),_0x25b3c6['appendChild'](_0x52c802);const _0x51da7c=document[_0xfadf68(0x198)](_0xfadf68(0x13c));_0x51da7c['textContent']=_0xfadf68(0x1bb)+_0x54ca2b+_0xfadf68(0x12c)+_0x521476,_0x51da7c['className']='px-3\x20py-1.5\x20text-sm\x20bg-blue-50\x20text-blue-800\x20font-medium\x20border-t\x20border-b',_0x25b3c6['appendChild'](_0x51da7c);const _0x3c8970=document[_0xfadf68(0x198)](_0xfadf68(0x199));_0x3c8970[_0xfadf68(0xee)]=_0xfadf68(0x17f),_0x3c8970['className']='px-3\x20py-1.5\x20text-sm\x20rounded-r-md\x20border\x20'+(_0x54ca2b===_0x521476?_0xfadf68(0x19a):_0xfadf68(0x1d7)),_0x3c8970['disabled']=_0x54ca2b===_0x521476,_0x3c8970[_0xfadf68(0x201)](_0xfadf68(0x117),()=>{awardedCurrentPage++,renderAwardedListTable();}),_0x25b3c6[_0xfadf68(0x1b1)](_0x3c8970);}function updateEmployeeListTable(_0x49d5ca){const _0x30db33=_0x33ff5b;employeeListTableBody[_0x30db33(0xd6)]=_0x30db33(0x183);}function showEditModal(_0x3c1459){const _0x300786=_0x33ff5b;console[_0x300786(0xe5)](_0x300786(0x180),_0x3c1459),currentEditingDocId=_0x3c1459['id'],editEmpId[_0x300786(0xee)]=_0x3c1459[_0x300786(0x1c8)]||_0x300786(0x128),editEmpName[_0x300786(0xee)]=_0x3c1459[_0x300786(0xfe)]||_0x300786(0x128),editEmpManager[_0x300786(0x175)]=_0x3c1459[_0x300786(0x104)]||'',editEmpTeam[_0x300786(0x175)]=_0x3c1459['Check_Place']||'',editError['textContent']='',editEmployeeModal[_0x300786(0xf9)][_0x300786(0xf0)]('hidden');}function closeEditModal(){const _0x20d5e2=_0x33ff5b;editEmployeeModal[_0x20d5e2(0xf9)]['add'](_0x20d5e2(0x184)),currentEditingDocId=null;}async function saveEmployeeChanges(){const _0x40c700=_0x33ff5b;if(!currentEditingDocId)return;const _0x33186a=editEmpManager[_0x40c700(0x175)],_0x1869d5=editEmpTeam[_0x40c700(0x175)];editError[_0x40c700(0xee)]='',saveEditModalButton[_0x40c700(0x12b)]=!![];try{const _0x286aa6=doc(db,dataEmployeeCollectionPath,currentEditingDocId);await updateDoc(_0x286aa6,{'Check_Manager':_0x33186a,'Check_Place':_0x1869d5}),console['log']('Employee\x20data\x20updated\x20successfully.'),closeEditModal();}catch(_0x1bbdb8){console[_0x40c700(0x13e)](_0x40c700(0x158),_0x1bbdb8),editError[_0x40c700(0xee)]='เกิดข้อผิดพลาด:\x20'+_0x1bbdb8[_0x40c700(0x1ed)];}finally{saveEditModalButton[_0x40c700(0x12b)]=![];}}function handleDownloadCSV(){const _0xffe7f4=_0x33ff5b;console[_0xffe7f4(0xe5)]('Generating\x20CSV...');const _0x29c4a7=allEmployeesData[_0xffe7f4(0x115)](_0x46de18=>{const _0x435634=_0xffe7f4,_0x1ef9f1=_0x46de18[_0x435634(0x104)]&&_0x46de18[_0x435634(0x104)][_0x435634(0x197)]()!=='',_0x279810=!!_0x46de18[_0x435634(0xfd)],_0x120cb9=_0x279810&&!_0x1ef9f1,_0x45fbf3=_0x1ef9f1;return _0x45fbf3||_0x120cb9;});if(_0x29c4a7[_0xffe7f4(0x1e8)]===0x0){console[_0xffe7f4(0x1bd)](_0xffe7f4(0x106));return;}const _0x7c3b95=[_0xffe7f4(0x1ec),_0xffe7f4(0x155),_0xffe7f4(0x17b),_0xffe7f4(0x126),'สายงาน\x20(Department_th)',_0xffe7f4(0x1c1),_0xffe7f4(0x1aa),_0xffe7f4(0x172),'เวลาที่ลงทะเบียน',_0xffe7f4(0x136)],_0x531244=_0x5b3c11=>{const _0x4de4f9=_0xffe7f4;if(_0x5b3c11===null||_0x5b3c11===undefined)return'\x22\x22';let _0x465bc4=String(_0x5b3c11);return(_0x465bc4[_0x4de4f9(0x108)]('\x22')||_0x465bc4[_0x4de4f9(0x108)](',')||_0x465bc4['includes']('\x0a'))&&(_0x465bc4='\x22'+_0x465bc4[_0x4de4f9(0x100)](/"/g,'\x22\x22')+'\x22'),_0x465bc4;};let _0x4bf91f=_0x7c3b95['join'](',')+'\x0a';_0x29c4a7['forEach'](_0x5c10cc=>{const _0x3916d0=_0xffe7f4,_0x16999d=_0x5c10cc['DateLogin']&&_0x5c10cc['DateLogin'][_0x3916d0(0x194)]?formatThaiTimestamp(_0x5c10cc[_0x3916d0(0xfd)][_0x3916d0(0x194)]()):'',_0x5cf68d=_0x5c10cc[_0x3916d0(0xfc)]&&_0x5c10cc['DateReward'][_0x3916d0(0x194)]?formatThaiTimestamp(_0x5c10cc[_0x3916d0(0xfc)][_0x3916d0(0x194)]()):'',_0x595613=[_0x5c10cc[_0x3916d0(0x1c8)]||'',_0x5c10cc[_0x3916d0(0xfe)]||'',_0x5c10cc[_0x3916d0(0x149)]||'',_0x5c10cc[_0x3916d0(0x14c)]||'',_0x5c10cc['Department_th']||'',_0x5c10cc[_0x3916d0(0x10a)]||'',_0x5c10cc[_0x3916d0(0x104)]||'',_0x5c10cc[_0x3916d0(0x1d2)]||'',_0x16999d,_0x5cf68d];_0x4bf91f+=_0x595613[_0x3916d0(0x1a8)](_0x531244)[_0x3916d0(0x11b)](',')+'\x0a';});const _0x595ad6=new Uint8Array([0xef,0xbb,0xbf]),_0x651376=new Blob([_0x595ad6,_0x4bf91f],{'type':_0xffe7f4(0xdc)}),_0x21ef86=document[_0xffe7f4(0x198)]('a'),_0x21f20e=URL[_0xffe7f4(0x121)](_0x651376);_0x21ef86['setAttribute']('href',_0x21f20e);const _0x562521=new Date()[_0xffe7f4(0x1e0)]()['slice'](0x0,0xa);_0x21ef86['setAttribute'](_0xffe7f4(0x1bc),_0xffe7f4(0x1d3)+_0x562521+_0xffe7f4(0x1ab)),_0x21ef86[_0xffe7f4(0x14d)][_0xffe7f4(0x1ee)]='hidden',document['body'][_0xffe7f4(0x1b1)](_0x21ef86),_0x21ef86[_0xffe7f4(0x117)](),document[_0xffe7f4(0x1f7)][_0xffe7f4(0x1f1)](_0x21ef86),console[_0xffe7f4(0xe5)](_0xffe7f4(0x15b));}async function updateRewardTime(_0x523c25,_0x4614fc){const _0x398ae2=_0x33ff5b;if(!_0x523c25)return;console[_0x398ae2(0xe5)](_0x398ae2(0x1d4)+_0x523c25+'\x20with\x20DateReward:',_0x4614fc);try{const _0x25f9c9=doc(db,dataEmployeeCollectionPath,_0x523c25);await updateDoc(_0x25f9c9,{'DateReward':_0x4614fc}),console[_0x398ae2(0xe5)](_0x398ae2(0x196));}catch(_0x130106){console[_0x398ae2(0x13e)]('Error\x20updating\x20DateReward:\x20',_0x130106),randomizeError[_0x398ae2(0xee)]=_0x398ae2(0x159)+_0x130106['message'];}}function handleShowConfirmCancelRandom(_0x26a956,_0x49f8f1){const _0x43e836=_0x33ff5b;docIdToCancel=_0x26a956,currentConfirmAction=async()=>{const _0x37ab5e=_0x1be1;await updateRewardTime(docIdToCancel,null),docIdToCancel=null,confirmModal[_0x37ab5e(0xf9)][_0x37ab5e(0xe2)](_0x37ab5e(0x184)),!winnerDetailModal['classList'][_0x37ab5e(0x1e3)](_0x37ab5e(0x184))&&winnerDetailModal['classList'][_0x37ab5e(0xe2)](_0x37ab5e(0x184));},confirmTitle[_0x43e836(0xee)]=_0x43e836(0x14f),confirmText[_0x43e836(0xee)]='คุณต้องการยกเลิกการสุ่มของ\x20['+_0x49f8f1+_0x43e836(0x146),confirmActionButton[_0x43e836(0xee)]=_0x43e836(0x18e),confirmActionButton[_0x43e836(0x1c7)]=_0x43e836(0x118),confirmActionButton[_0x43e836(0x12b)]=![],confirmActionButton[_0x43e836(0xf9)][_0x43e836(0xf0)](_0x43e836(0x184)),confirmActionButton[_0x43e836(0x1e6)]=()=>{const _0x4e96cf=_0x43e836;typeof currentConfirmAction===_0x4e96cf(0x140)&&currentConfirmAction();},closeConfirmButton['textContent']=_0x43e836(0x13a),closeConfirmButton['disabled']=![],closeConfirmButton[_0x43e836(0xf9)][_0x43e836(0xf0)](_0x43e836(0x184)),confirmModal[_0x43e836(0xf9)]['remove'](_0x43e836(0x184));}async function handleRandomization(){const _0x484d9a=_0x33ff5b,_0x1b6fee=allEmployeesData[_0x484d9a(0x115)](_0x22b7b0=>_0x22b7b0['DateReward'])[_0x484d9a(0x1e8)];if(currentRewardLimit>0x0&&_0x1b6fee>=currentRewardLimit){randomizeError[_0x484d9a(0xee)]=_0x484d9a(0x1f9)+currentRewardLimit+'\x20คน)',startRandomizeButton[_0x484d9a(0x12b)]=!![];return;}if(availableToDraw['length']===0x0){randomizeError[_0x484d9a(0xee)]=_0x484d9a(0x1f6);return;}startRandomizeButton[_0x484d9a(0x12b)]=!![],randomizeError['textContent']='';let _0x34b373=0x0;randomizationInterval=setInterval(()=>{const _0x4ada9a=_0x484d9a;digits['forEach'](_0x3297d1=>{const _0x1708fb=_0x1be1;_0x3297d1[_0x1708fb(0xee)]=Math[_0x1708fb(0x17a)](Math[_0x1708fb(0x1ef)]()*0xa);}),_0x34b373++;if(_0x34b373>0x14){clearInterval(randomizationInterval);const _0x4f6c55=availableToDraw[Math[_0x4ada9a(0x17a)](Math[_0x4ada9a(0x1ef)]()*availableToDraw[_0x4ada9a(0x1e8)])],_0x16b878=(_0x4f6c55[_0x4ada9a(0x1c8)]||_0x4ada9a(0x1c6))[_0x4ada9a(0x1b9)](-0x5)[_0x4ada9a(0x182)](0x5,'0');digits[_0x4ada9a(0x1a1)]((_0x5d0b3c,_0x5397db)=>_0x5d0b3c['textContent']=_0x16b878[_0x5397db]),updateRewardTime(_0x4f6c55['id'],serverTimestamp())[_0x4ada9a(0x1f0)](()=>{const _0xa40973=_0x4ada9a;winnerName[_0xa40973(0xee)]=_0x4f6c55['FullName_th']||_0xa40973(0x128),winnerEmployeeId[_0xa40973(0xee)]=_0xa40973(0x193)+(_0x4f6c55[_0xa40973(0x1c8)]||_0xa40973(0x128)),winnerTeam[_0xa40973(0xee)]=_0xa40973(0xdb)+(_0x4f6c55[_0xa40973(0x1d2)]||_0xa40973(0x128)),winnerBU[_0xa40973(0xee)]=_0xa40973(0xef)+(_0x4f6c55[_0xa40973(0x10a)]||_0xa40973(0x128)),cancelWinnerButton[_0xa40973(0x1a6)][_0xa40973(0x13b)]=_0x4f6c55['id'],winnerDetailModal[_0xa40973(0xf9)][_0xa40973(0xf0)](_0xa40973(0x184));});}},0x64);}async function handleCancelWinner(){const _0x485c39=_0x33ff5b,_0x5052b6=cancelWinnerButton[_0x485c39(0x1a6)][_0x485c39(0x13b)],_0x2f21d6=allEmployeesData[_0x485c39(0x116)](_0x2d2592=>_0x2d2592['id']===_0x5052b6);handleShowConfirmCancelRandom(_0x5052b6,_0x2f21d6?.[_0x485c39(0xfe)]||_0x485c39(0x128));}function updateRandomizerFilterButtonsUI(){const _0x3036ab=_0x33ff5b,_0x45ebc0=[{'el':randomFilterParticipants,'mode':_0x3036ab(0x103)},{'el':randomFilterAttendees,'mode':'attendees'},{'el':randomFilterAll,'mode':_0x3036ab(0x122)}];_0x45ebc0[_0x3036ab(0x1a1)](_0x3a550a=>{const _0x229fd5=_0x3036ab;_0x3a550a['mode']===currentRandomizerMode?_0x3a550a['el'][_0x229fd5(0x1c7)]=_0x229fd5(0x1eb):_0x3a550a['el'][_0x229fd5(0x1c7)]=_0x229fd5(0x19c);});}function updateRandomizerDataBasedOnAllEmployees(){const _0x4a0ff7=_0x33ff5b,_0x2caecf=allParticipants[_0x4a0ff7(0x115)](_0xe9c596=>_0xe9c596[_0x4a0ff7(0xfc)]),_0x157329=allParticipants[_0x4a0ff7(0x115)](_0x462eeb=>!_0x462eeb[_0x4a0ff7(0xfc)]),_0x2e170b=allAttendees['filter'](_0x428fa4=>_0x428fa4[_0x4a0ff7(0xfc)]),_0x4e96f0=allAttendees[_0x4a0ff7(0x115)](_0x47e352=>!_0x47e352[_0x4a0ff7(0xfc)]),_0x4ff934=[..._0x2caecf,..._0x2e170b],_0x4c69ae=[..._0x157329,..._0x4e96f0];if(currentRandomizerMode===_0x4a0ff7(0x103))availableToDraw=_0x157329,alreadyDrawn=_0x2caecf;else currentRandomizerMode===_0x4a0ff7(0x147)?(availableToDraw=_0x4e96f0,alreadyDrawn=_0x2e170b):(availableToDraw=_0x4c69ae,alreadyDrawn=_0x4ff934);randomizeError['textContent']='';}function updateModalUI(){const _0x4a96a7=_0x33ff5b;modalParticipantsCount[_0x4a96a7(0xee)]=availableToDraw['length'],modalDrawnCount['textContent']=alreadyDrawn[_0x4a96a7(0x1e8)],renderDrawnWinnersTable(),randomizeError[_0x4a96a7(0xee)]='',startRandomizeButton['disabled']=![];const _0x3766a6=allEmployeesData[_0x4a96a7(0x115)](_0x827020=>_0x827020[_0x4a96a7(0xfc)])[_0x4a96a7(0x1e8)];availableToDraw['length']===0x0&&(startRandomizeButton[_0x4a96a7(0x12b)]=!![],randomizeError[_0x4a96a7(0xee)]=_0x4a96a7(0x14a)),currentRewardLimit>0x0&&_0x3766a6>=currentRewardLimit&&(startRandomizeButton[_0x4a96a7(0x12b)]=!![],randomizeError[_0x4a96a7(0xee)]=_0x4a96a7(0x1f9)+currentRewardLimit+_0x4a96a7(0x1d0));}function renderDrawnWinnersTable(){const _0x3406bc=_0x33ff5b;drawnWinnersTableBody[_0x3406bc(0xd6)]='';if(alreadyDrawn['length']===0x0){drawnWinnersTableBody[_0x3406bc(0xd6)]=_0x3406bc(0x12e);return;}alreadyDrawn[_0x3406bc(0x127)]((_0x26ae2c,_0x7a77f7)=>(_0x7a77f7[_0x3406bc(0xfc)]?_0x7a77f7['DateReward'][_0x3406bc(0x194)]():0x0)-(_0x26ae2c['DateReward']?_0x26ae2c[_0x3406bc(0xfc)]['toDate']():0x0)),alreadyDrawn[_0x3406bc(0x1a1)](_0x2b2a9f=>{const _0x4a5b0a=_0x3406bc,_0x3da9fd=document[_0x4a5b0a(0x198)]('tr');_0x3da9fd[_0x4a5b0a(0x1c7)]=_0x4a5b0a(0x164);const _0x3e5323=document[_0x4a5b0a(0x198)]('button');_0x3e5323[_0x4a5b0a(0xee)]='ยกเลิก',_0x3e5323[_0x4a5b0a(0x1c7)]=_0x4a5b0a(0x11d),_0x3e5323[_0x4a5b0a(0x1e6)]=()=>handleShowConfirmCancelRandom(_0x2b2a9f['id'],_0x2b2a9f['FullName_th']),_0x3da9fd[_0x4a5b0a(0xd6)]=_0x4a5b0a(0xf2)+(_0x2b2a9f[_0x4a5b0a(0x1c8)]||'')+_0x4a5b0a(0xd7)+(_0x2b2a9f[_0x4a5b0a(0xfe)]||'')+_0x4a5b0a(0xd7)+(_0x2b2a9f[_0x4a5b0a(0x10a)]||'')+_0x4a5b0a(0x1db),_0x3da9fd['cells'][0x3]['appendChild'](_0x3e5323),drawnWinnersTableBody[_0x4a5b0a(0x1b1)](_0x3da9fd);});}function setupEmployeeListListeners(){const _0x1c4ab6=_0x33ff5b;awardedSearchInput['addEventListener'](_0x1c4ab6(0x125),()=>{awardedCurrentPage=0x1,filterAndRenderAwardedList();}),closeEditModalButton['addEventListener'](_0x1c4ab6(0x117),closeEditModal),saveEditModalButton[_0x1c4ab6(0x201)]('click',saveEmployeeChanges);}function setupAwardedListListeners(){const _0x47dc98=_0x33ff5b;awardedSearchInput[_0x47dc98(0x201)](_0x47dc98(0x125),()=>{awardedCurrentPage=0x1,filterAndRenderAwardedList();});}function setupTabListeners(){const _0x42b34f=[{'btn':tabDashboard,'content':dashboardContent},{'btn':tabTeamList,'content':teamListContent},{'btn':tabEmployeeList,'content':employeeListContent},{'btn':tabRegister,'content':registerContent}];_0x42b34f['forEach'](_0x47a2d0=>{const _0x110171=_0x1be1;_0x47a2d0[_0x110171(0xda)][_0x110171(0x201)](_0x110171(0x117),()=>{const _0x2ce6c2=_0x110171;_0x42b34f[_0x2ce6c2(0x1a1)](_0x1dd51b=>{const _0x467a21=_0x2ce6c2;_0x1dd51b[_0x467a21(0xda)]['classList'][_0x467a21(0xf0)](_0x467a21(0xe7),_0x467a21(0xe1),'border-blue-600'),_0x1dd51b[_0x467a21(0xda)][_0x467a21(0xf9)][_0x467a21(0xe2)](_0x467a21(0x14e),_0x467a21(0x150),_0x467a21(0xde)),_0x1dd51b['content'][_0x467a21(0xf9)][_0x467a21(0xe2)](_0x467a21(0x184));}),_0x47a2d0[_0x2ce6c2(0xda)]['classList']['add'](_0x2ce6c2(0xe7),_0x2ce6c2(0xe1),_0x2ce6c2(0x1b0)),_0x47a2d0[_0x2ce6c2(0xda)][_0x2ce6c2(0xf9)][_0x2ce6c2(0xf0)](_0x2ce6c2(0x14e),_0x2ce6c2(0x150),_0x2ce6c2(0xde)),_0x47a2d0['content'][_0x2ce6c2(0xf9)]['remove']('hidden'),_0x47a2d0[_0x2ce6c2(0xda)]['id']==='tab-employee-list'&&filterAndRenderAwardedList();});});}function showDetailModal(_0x10a768){const _0xc50c0f=_0x33ff5b;currentDocIdToDelete=_0x10a768['id'],detailEmpId['value']=_0x10a768[_0xc50c0f(0x1c8)]||_0xc50c0f(0x128),detailEmpName[_0xc50c0f(0x175)]=_0x10a768['FullName_th']||'N/A',detailEmpChief[_0xc50c0f(0x175)]=_0x10a768[_0xc50c0f(0x190)]||_0x10a768[_0xc50c0f(0x104)]||_0xc50c0f(0x128),detailEmpDateLogin[_0xc50c0f(0x175)]=_0x10a768[_0xc50c0f(0xfd)]?formatThaiTimestamp(_0x10a768[_0xc50c0f(0xfd)][_0xc50c0f(0x194)]()):_0xc50c0f(0x128),detailEmpCheckPlace[_0xc50c0f(0x175)]=_0x10a768['Check_Place']||_0xc50c0f(0x128),detailEmpDateReward[_0xc50c0f(0x175)]=_0x10a768[_0xc50c0f(0xfc)]?formatThaiTimestamp(_0x10a768[_0xc50c0f(0xfc)]['toDate']()):_0xc50c0f(0x128),detailEmployeeModal[_0xc50c0f(0xf9)][_0xc50c0f(0xf0)](_0xc50c0f(0x184));}function closeDetailModal(){const _0x37e98b=_0x33ff5b;detailEmployeeModal[_0x37e98b(0xf9)][_0x37e98b(0xe2)](_0x37e98b(0x184)),currentDocIdToDelete=null;}function setupDetailModalListeners(){const _0x4fed78=_0x33ff5b;closeDetailModalButton[_0x4fed78(0x201)](_0x4fed78(0x117),closeDetailModal),confirmDeleteDetailButton[_0x4fed78(0x201)](_0x4fed78(0x117),()=>{const _0x48614e=_0x4fed78;if(currentDocIdToDelete){const _0x4ef7d3=allEmployeesData[_0x48614e(0x116)](_0x523403=>_0x523403['id']===currentDocIdToDelete)?.[_0x48614e(0xfe)]||_0x48614e(0x128);handleShowConfirmDeleteRegistration(currentDocIdToDelete,_0x4ef7d3);}});}function handleShowConfirmDeleteRegistration(_0x464b4a,_0x273ddd){const _0x328c0d=_0x33ff5b;currentConfirmAction=async()=>{const _0x49f59e=_0x1be1;await clearEmployeeData(_0x464b4a),confirmModal[_0x49f59e(0xf9)][_0x49f59e(0xe2)](_0x49f59e(0x184));},confirmTitle['textContent']=_0x328c0d(0xf4),confirmText['textContent']=_0x328c0d(0x18f)+_0x273ddd+_0x328c0d(0x143),confirmActionButton[_0x328c0d(0xee)]=_0x328c0d(0x1e1),confirmActionButton[_0x328c0d(0x1c7)]='px-3\x20py-1.5\x20text-xs\x20bg-red-600\x20text-white\x20rounded-md\x20hover:bg-red-700',confirmActionButton[_0x328c0d(0x12b)]=![],detailEmployeeModal[_0x328c0d(0xf9)][_0x328c0d(0xe2)](_0x328c0d(0x184)),confirmModal[_0x328c0d(0xf9)][_0x328c0d(0xf0)](_0x328c0d(0x184));}function showRewardControlModal(){const _0x142af1=_0x33ff5b,_0x37a471=rewardControlButton[_0x142af1(0xee)]===_0x142af1(0x18c);rewardControlStatusText[_0x142af1(0xd6)]=_0x142af1(0x1f4)+(_0x37a471?_0x142af1(0x1a5):_0x142af1(0x17c))+'\x22>'+(_0x37a471?'เปิดรับของรางวัล':_0x142af1(0x18c))+_0x142af1(0x1d6),_0x37a471?(toggleRewardActionButton['textContent']=_0x142af1(0x1f8),toggleRewardActionButton[_0x142af1(0x1c7)]='px-4\x20py-2\x20text-sm\x20font-medium\x20text-white\x20bg-red-600\x20rounded-md\x20hover:bg-red-700\x20transition\x20duration-150',toggleRewardActionButton[_0x142af1(0x1e6)]=()=>updateRewardStatus(0x0)):(toggleRewardActionButton['textContent']=_0x142af1(0x1d8),toggleRewardActionButton[_0x142af1(0x1c7)]='px-4\x20py-2\x20text-sm\x20font-medium\x20text-white\x20bg-green-600\x20rounded-md\x20hover:bg-green-700\x20transition\x20duration-150',toggleRewardActionButton[_0x142af1(0x1e6)]=()=>updateRewardStatus(0x1)),rewardControlModal[_0x142af1(0xf9)][_0x142af1(0xf0)]('hidden');}function closeRewardControlModalFunc(){const _0xdec3f5=_0x33ff5b;rewardControlModal['classList']['add'](_0xdec3f5(0x184));}async function updateRewardStatus(_0x323e2f){const _0x211f5a=_0x33ff5b;console[_0x211f5a(0xe5)]('Setting\x20open_reward\x20status\x20to:\x20'+_0x323e2f),toggleRewardActionButton[_0x211f5a(0x12b)]=!![];try{await setDoc(rewardSettingsDocPath,{'open_reward':_0x323e2f},{'merge':!![]}),console[_0x211f5a(0xe5)](_0x211f5a(0x168)+_0x323e2f),closeRewardControlModalFunc();}catch(_0x168bee){console['error'](_0x211f5a(0x1d9),_0x168bee);const _0xa02552=_0x211f5a(0xf7)+_0x168bee[_0x211f5a(0x1ed)];rewardControlStatusText[_0x211f5a(0xd6)]=_0x211f5a(0xe3)+_0xa02552+_0x211f5a(0x1d6);}finally{toggleRewardActionButton[_0x211f5a(0x12b)]=![];}}function setupRewardControlListeners(){const _0x57107e=_0x33ff5b;rewardControlButton[_0x57107e(0x201)](_0x57107e(0x117),showRewardControlModal),closeRewardControlModal[_0x57107e(0x201)](_0x57107e(0x117),closeRewardControlModalFunc);}function setupModalListeners(){const _0x450338=_0x33ff5b;randomizeButton[_0x450338(0x201)]('click',()=>{const _0x41e713=_0x450338;currentRandomizerMode=_0x41e713(0x103),updateRandomizerFilterButtonsUI(),updateRandomizerDataBasedOnAllEmployees(),updateModalUI(),randomizeModal[_0x41e713(0xf9)][_0x41e713(0xf0)]('hidden');}),closeRandomizeModalButton[_0x450338(0x201)](_0x450338(0x117),()=>{const _0x2d4aa2=_0x450338;randomizeModal['classList'][_0x2d4aa2(0xe2)](_0x2d4aa2(0x184));}),startRandomizeButton['addEventListener']('click',handleRandomization),closeWinnerModalButton[_0x450338(0x201)]('click',()=>{const _0x3b7ee2=_0x450338;winnerDetailModal[_0x3b7ee2(0xf9)][_0x3b7ee2(0xe2)](_0x3b7ee2(0x184));}),cancelWinnerButton[_0x450338(0x201)](_0x450338(0x117),handleCancelWinner),closeConfirmButton[_0x450338(0x201)](_0x450338(0x117),()=>{const _0x4d4e20=_0x450338;confirmModal[_0x4d4e20(0xf9)][_0x4d4e20(0xe2)]('hidden'),confirmTitle[_0x4d4e20(0xee)]=_0x4d4e20(0x137),confirmText['textContent']='',confirmActionButton['disabled']=![],confirmActionButton[_0x4d4e20(0xf9)][_0x4d4e20(0xf0)]('hidden'),closeConfirmButton[_0x4d4e20(0xee)]=_0x4d4e20(0x13a),closeConfirmButton[_0x4d4e20(0x12b)]=![],currentConfirmAction=null,docIdToCancel=null;}),downloadCsvButton['addEventListener']('click',handleDownloadCSV),randomFilterParticipants[_0x450338(0x201)](_0x450338(0x117),()=>{const _0x13fb07=_0x450338;currentRandomizerMode=_0x13fb07(0x103),updateRandomizerFilterButtonsUI(),updateRandomizerDataBasedOnAllEmployees(),updateModalUI();}),randomFilterAttendees[_0x450338(0x201)](_0x450338(0x117),()=>{currentRandomizerMode='attendees',updateRandomizerFilterButtonsUI(),updateRandomizerDataBasedOnAllEmployees(),updateModalUI();}),randomFilterAll[_0x450338(0x201)](_0x450338(0x117),()=>{const _0x4b13bd=_0x450338;currentRandomizerMode=_0x4b13bd(0x122),updateRandomizerFilterButtonsUI(),updateRandomizerDataBasedOnAllEmployees(),updateModalUI();}),confirmActionButton['addEventListener'](_0x450338(0x117),()=>{currentConfirmAction&&currentConfirmAction();});}function _0x5153(){const _0x3dad64=['download','warn','data','main','px-4\x20py-2\x20text-sm\x20font-medium\x20text-white\x20bg-green-600\x20rounded-md\x20shadow-md\x20hover:bg-green-700\x20transition\x20duration-150\x20ease-in-out','กลุ่ม\x20(BU)','winnerDetailModal','long','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','teamBarChart2','00000','className','employeeId','labels','detailEmpName','update','getContext','#93C5FD','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20font-medium\x22>','bold','\x20คน)','th-TH','Check_Place','CRSG_Registered_Users_','Updating\x20doc\x20','registered','</span>','bg-white\x20hover:bg-gray-100','เปิดรับของรางวัล','Error\x20updating\x20reward\x20status:','Employee\x20document\x20not\x20found\x20for\x20deletion.','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','number_getreward','690641tgrbzd','number_reward','<p\x20class=\x22text-red-600\x20text-center\x20text-lg\x20mt-10\x22>เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','toISOString','ยืนยันการลบข้อมูล','getElementById','contains','รับแล้ว','doughnut','onclick','editEmpTeam','length','380164mgnsDl','Debug','px-3\x20py-1.5\x20text-xs\x20font-medium\x20rounded-md\x20transition-colors\x20bg-orange-200\x20text-orange-800','รหัสพนักงาน','message','visibility','random','then','removeChild','backgroundColor','randomFilterAll','สถานะปัจจุบัน:\x20<span\x20class=\x22','เป้าหมายที่เหลือ','ไม่เหลือผู้เข้าร่วมกิจกรรมให้สุ่มแล้ว','body','ปิดการรับของรางวัล','สุ่มครบตามจำนวนที่กำหนดแล้ว\x20(','ผู้เข้าร่วมกิจกรรม','#10B981','confirmActionButton',')</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','open_reward','randomizeButton','randomizeError','addEventListener','dataIndex','innerHTML','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>','Failed\x20to\x20setup\x20settings\x20listener:','participantsTableBody','btn','ทีม:\x20','text/csv;charset=utf-8;','Firebase\x20initialization\x20failed:','border-transparent','1FNJBiD','Error\x20listening\x20to\x20settings:','bg-gray-300','add','<span\x20class=\x22text-red-600\x22>','rewardControlButton','log','reduce','text-gray-700','closeConfirmButton','วันที่\x20','ก่อนหน้า','DateConfirm','max','attendeesCount','textContent','สายงาน:\x20','remove','tab-team-list','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>','register-content','ยืนยันการล้างข้อมูลพนักงาน','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','toFixed','เกิดข้อผิดพลาดในการบันทึกสถานะ:\x20','specialRewardLimitInput','classList','</p>','rewardedCountElem','DateReward','DateLogin','FullName_th','toLocaleDateString','replace','randomFilterParticipants','\x20คน','participants','Check_Manager','digit1','No\x20data\x20to\x20download\x20based\x20on\x20criteria.','digit4','includes','employee-list-content','BU_th','detailEmpCheckPlace','editEmployeeModal','Reward\x20settings\x20doc\x20not\x20found.\x20Cannot\x20update\x20number_extra/number_reward.','detailEmpDateReward','tab-register','detailEmpDateLogin','Error\x20clearing\x20registration\x20data:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','ได้รางวัล','keys','filter','find','click','px-3\x20py-1.5\x20text-xs\x20bg-red-600\x20text-white\x20rounded-md\x20hover:bg-red-700','670tcEpQF','text-white\x20bg-red-600\x20hover:bg-red-700\x20text-xs\x20py-1\x20px-3\x20rounded-md\x20transition\x20duration-150','join','Error\x20listening\x20to\x20data:','text-red-600\x20hover:text-red-800\x20text-xs\x20py-1\x20px-2\x20rounded','editEmpId','winnerEmployeeId','ยังไม่รับ','createObjectURL','all','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','min','input','ตำแหน่ง\x20(Position_th)','sort','N/A','editEmpName','Error\x20updating\x20number_reward:','disabled','\x20จาก\x20','remainingCount','<tr><td\x20colspan=\x224\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ยังไม่มีผู้ได้รับการสุ่ม</td></tr>','chart','drawnWinnersTableBody','7835784snQCyP','\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ยังไม่มีผู้ลงทะเบียน</td></tr>','datasets','ผู้ร่วมงาน','winnerTeam','เวลาที่สุ่ม\x20(DateReward)','ยืนยัน','total','latestRegistrationsTableBody','ไม่','docId','span','Admin\x20Signed\x20in\x20anonymously','error','awardedListTableBody','function','ลงทะเบียนแล้ว','startRandomizeButton',']\x20หรือไม่?','<tr><td\x20colspan=\x225\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ไม่พบพนักงานที่ร่วมกิจกรรม\x20(ผู้มีสังกัด)\x20ที่ลงทะเบียนแล้ว</td></tr>','currentDateTime',']\x20ใช่หรือไม่?\x20(พนักงานจะกลับเข้าไปอยู่ในกลุ่มที่สุ่มได้อีกครั้ง)','attendees','Yes','NickName','ไม่เหลือผู้ให้สุ่มในกลุ่มนี้แล้ว','ยังไม่ลงทะเบียน','Position_th','style','text-gray-500','ยืนยันการยกเลิกการสุ่ม','bg-gray-100','526586iSZsMb','G-9DJLWJ5LQ1','exists','rewardControlModal','ชื่อ-นามสกุล','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','activeElement','Error\x20saving\x20employee\x20changes:','เกิดข้อผิดพลาดในการอัปเดต:\x20','No\x20settings\x20document\x20found.\x20Using\x20default\x20limit\x200.','CSV\x20Download\x20triggered.','468BXzLIz','data_reward','ceil','closeWinnerModalButton','Registration/Reward\x20data\x20cleared\x20for\x20','1285NKcwde','modalDrawnCount','team-list-content','hover:bg-gray-50','center','awardedPaginationControls','\x20เวลา\x20','Reward\x20status\x20successfully\x20set\x20to\x20','randomFilterAttendees','bar','#ffffff','confirmedRewardCountTeam','#3B82F6','#2563EB','downloadCsvButton','#6b7280','toLocaleString','ทีม\x20(Check_Place)','1422jbboda','numeric','value','winnerBU','tab-employee-list','participantsCountBox','editEmpManager','floor','ชื่อเล่น','text-red-600\x20font-bold','16Dfqycc','1070273157855','ถัดไป','Editing:','</td>\x20<!--\x20(แก้ไข)\x20รับแล้ว\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','padStart','<tr><td\x20colspan=\x226\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ฟังก์ชันถูกย้ายไปที่แท็บ\x20\x27ข้อมูลผู้ได้รับรางวัล\x27</td></tr>','hidden','toggleRewardActionButton','push','<tr><td\x20colspan=\x226\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ไม่พบผู้ได้รับรางวัล</td></tr>','number_extra','resolve','bottom','ttb-register','ปิดรับของรางวัล','managerEmployeeCount','ใช่,\x20ยืนยันยกเลิก','คุณต้องการล้างข้อมูลการลงทะเบียนและรางวัล\x20(DateLogin,\x20DateReward,\x20DateConfirm)\x20ของ\x20[','Chief','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','cells','รหัส:\x20','toDate','short','Update\x20successful','trim','createElement','button','bg-gray-100\x20text-gray-500\x20cursor-not-allowed','editError','px-3\x20py-1.5\x20text-xs\x20font-medium\x20rounded-md\x20transition-colors\x20bg-gray-200\x20text-gray-700','confirmDeleteDetailButton','toLowerCase','label','randomizeModal','forEach','breakdownCenterTotal','rewardControlStatusText','awardedSearchInput','text-green-600\x20font-bold','dataset','text-blue-600\x20font-medium','map','593742EMDqsH','สังกัด\x20(Check_Manager)','.csv','unregistered','ttb-register.firebasestorage.app','parsed','confirmText','border-blue-600','appendChild','detailEmpId','end','80%','closeEditModalButton','detailEmpChief','text-green-600','2-digit','slice','จำนวนผู้เข้าร่วม','หน้า\x20'];_0x5153=function(){return _0x3dad64;};return _0x5153();}try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel(_0x33ff5b(0x1ea)),await signInAnonymously(auth),console[_0x33ff5b(0xe5)](_0x33ff5b(0x13d)),dataEmployeeCollectionPath='data_employee',rewardSettingsDocPath=doc(db,_0x33ff5b(0x15d),_0x33ff5b(0x1bf)),initializeCharts(),setupTabListeners(),listenToAllCrsgData(),listenToRewardSettings(),setupModalListeners(),setupEmployeeListListeners(),setupRewardSettingsListener(),setupDetailModalListeners(),setupAwardedListListeners(),setupRewardControlListeners(),updateCurrentDateTime(),setInterval(updateCurrentDateTime,0x3e8);}catch(_0xf3e4f8){console[_0x33ff5b(0x13e)](_0x33ff5b(0xdd),_0xf3e4f8),document[_0x33ff5b(0x1f7)][_0x33ff5b(0xd6)]=_0x33ff5b(0x1df)+_0xf3e4f8[_0x33ff5b(0x1ed)]+_0x33ff5b(0xfa);}
        
    </script>
</body>
</html>