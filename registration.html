<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ttb Registration System</title>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PW7HPDW');</script>
  <!-- End Google Tag Manager -->
  <link href="./img/favicom.ico" rel="icon">
  <link rel="stylesheet" href="./css/ekachon.css"> 
  <link rel="stylesheet" href="./css/style.css"> 
  <link rel="stylesheet" href="./css/w3.css"> 
  <link rel="stylesheet" href="./css/templatemo-ocean-vibes.css">
  <link rel="stylesheet" href="./css/button.css"> 
  <link rel="stylesheet" href="./css/index@.css">
  <link href='css/vdo.css' rel="stylesheet" type="text/css">
  <script src="https://static.line-scdn.net/liff/edge/versions/2.12.0/sdk.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-storage.js"></script>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.3/css/bootstrapValidator.min.css" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script type="text/javascript">
  (function() {
    'use strict';
    window.addEventListener('load', function() {
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.getElementsByClassName('needs-validation');
      // Loop over them and prevent submission
      var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();    
  </script>
  <style type="text/css">
    .navbar { padding: .8rem 1rem; };
  </style>
</head>
<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="60" style="background: #002d63;">
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PW7HPDW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <div class="navbar1">
    <center>
      <div style="max-width:400px;">
        <div class="iconlink" onClick="window.location='registration.html';" style="background-color: #002d63;">
          <div style="width:28px;"><img src="./img/regis.png" style="width:22px;"></div>
          <div style="font-size: 11px;">ลงทะเบียน</div>
        </div>
        <div class="iconlink" onClick="window.location='vaccine.html';">
          <div style="width:28px;"><img src="./img/syringe.png" style="width:22px;"></div>
          <div style="font-size: 11px;">วัคซีน</div>
        </div>
        <div class="iconlink" onClick="window.location='history.html';">
          <div style="width:28px;"><img src="./img/checked.png" style="width:22px;"></div>
          <div style="font-size: 11px;">ประวัติ</div>
        </div>
        <div class="iconlink" onClick="window.location='howto.html';">
          <div style="width:28px;"><img src="./img/howto.png" style="width:22px;"></div>
          <div style="font-size: 11px;">วิธีใช้</div>
        </div>
      </div>
    </center>
  </div>


  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand" href="#myPage" onclick="location.href='registration.html'" style="font-size: 13px;">ttb Registration System</a>
      </div>
    </div>
  </nav>


  <div id="BootCampLoading" class="carousel slide text-center" data-ride="carousel" style="display: none;">
    <div class="form_wrapper" style="border-top:8px solid #f68b1f;">
      <div class="form_container">
        <div class="clr"></div>
<!--
        <div class="title-head">ttb Registration System</div>
        <div style="color:#ff0000; font-weight: 600;font-size: 14px;">"ระบบลงทะเบียนล่วงหน้า"</div>
        <div style="margin-top:-1px;"><img src ="./event/wb-register-pre.jpg" style="width:100%; max-width:240px;"></div>
-->
        <div id="DisplayPreReg"></div>
        <div style="padding:30px;" id="loading"><img src="./img/loading.gif"><div style="padding-top:15px;color:#f68b1f;">L o a d i n g</div></div>
        <div style="display: none;margin:10px 0 20px 0;" id="gotoLink"></div>

      </div>
    </div>
  </div>


  <div id="BootCampClose" class="carousel slide text-center" data-ride="carousel" style="display: none;">
    <div class="form_wrapper" style="border-top:8px solid #f68b1f;">
      <div class="form_container">
        <div class="clr"></div>
        <div class="title-head">ttb Registration System</div>
        <div style="color:#ff0000; font-weight: 600;font-size: 14px;">"ระบบลงทะเบียนล่วงหน้า"</div>
        <div style="margin:15px auto;"><img src ="./img/Register.png" style="width:100%; max-width:240px;"></div>
        <div class="btn-t5">ขณะนี้ระบบลงทะเบียนล่วงหน้า<br>ยังไม่เปิดให้ลงทะเบียน</div>
        <div class="clr" style="height: 20px;"></div>
      </div>
    </div>
  </div>


  <div id="OpenBootCamp" class="carousel slide text-center" data-ride="carousel" style="display: none;">
    <div class="clr"></div>
    <div class="form_wrapper">
      <div class="form_container">
        <div class="title_container">
          <div class="title-head">ttb Registration System</div>
          <div style="color:#ff0000; font-weight: 600;font-size: 14px;">"ระบบลงทะเบียนล่วงหน้า"</div>
          <div style="padding-top:15px;"><img src ="./img/Register.png" style="width:100%; max-width:360px;"></div>
          <div id="OpenRound"></div>
        </div>
      </div>
    </div>
    <div class="clr" style="height: 60px;"></div>
  </div>


  <div id="myRegister" class="carousel slide text-center" data-ride="carousel" style="display: none;">
    <div class="clr"></div>
    <div class="form_wrapper">
      <div class="form_container">
        <div class="title_container">
          <div class="title-head">ttb Registration System</div>
          <div style="color:#ff0000; font-weight: 600;font-size: 14px;">"ระบบลงทะเบียนล่วงหน้า"</div>
          <div id="DisplayRound" class="profile-txt" style="font-size:12px;margin-top:-10px;"></div>
        </div>
        <div class="row clearfix">
          <div class="">
            <center>
              <div id="MyProfile"></div>
            </center>
            <form style="margin-top:20px;" class="needs-validation" novalidate>
              <div class="form-row">
                <div style="color:#ff0000;">หากไม่ได้เป็นพนักงานของ ttb ใส่รหัสเป็น 99999</div>
                <div class="input_field" style="width:100% !important;"> 
                  <span><i aria-hidden="true" class="fa fa-lock"></i></span>
                  <input required type="number" class="form-control" id="txtEmpID" placeholder="รหัสพนักงาน"/>
                  <div class="valid-feedback"></div>
                </div>
                <div class="input_field" style="width:100% !important;"> 
                  <span><i aria-hidden="true" class="fa fa-user"></i></span>
                  <input type="text" class="form-control" id="txtEmpName" placeholder="ชื่อ-นามสกุล" required/>
                </div>
                <div>สังกัด <font color="#ff0000">(ไม่ได้เป็นพนักงาน ttb เลือก บุคคลภายนอกธนาคาร)</font></div>
                <div class="input_field select_option">
                  <select id="txtEmpGroup" class="form-control" style="font: 400 12px ekachon-regular !important;" required/>
                    <option></option>
                    <option value="ttb bank">พนักงาน ttb bank</option>
                    <option value="OTHER-Outsider">บุคคลภายนอกธนาคาร</option>
                  </select>
                  <div class="select_arrow"></div>
                </div>

                <div>แจ้งผลการตรวจ ATK</div>
                <div class="input_field select_option">
                  <select id="txtATK" class="form-control" style="font: 400 12px ekachon-regular !important;" placeholder="ผลตรวจ ATK" required/>
                    <option></option>
                    <option value="Negative">Negative (ไม่พบเชื้อ)</option>
                    <option value="Positive">Positive (พบเชื้อ)</option>
                  </select>
                  <div class="select_arrow"></div>
                </div>

                <div>Upload Files รูปถ่าย ATK ของคุณ</div>
                <div style="border:1px solid #cccccc; width:100%; padding:15px; border-radius: 5px; margin-top:5px; background:#f1f1f1;">
                  <center>
                    <div id="CheckUpload" style="font-size: 11px; color:#0056ff;"><input type="file" id="files" style="cursor: pointer;" multiple /><div>
                  <div id="Fileimguploading" style="display: none;">
                    <div style="padding:40px;"><img src="./img/loading.gif"></div>
                  </div>
                  <div id="DisplayUploading" style="display: none; width:80%;">
                    <div id="MyATKUPloading"></div>
                  </div>
                  </center>
                </div>

              </div>
              <div class="btn-t1" onclick="ClickSaveProfile()" type="submit" id="test" style="margin-top:20px;">คลิกเพื่อลงทะเบียน</div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="myTimer" class="carousel slide text-center" data-ride="carousel" style="display: none;">
    <div class="clr"></div>
    <div class="form_wrapper">
      <div class="form_container">
        <div class="clearfix" style="margin:10px 0 20px 0;">
          <div id="MyWating"></div>
        </div>
      </div>
    </div>
  </div>


  <div class="clr"></div>
  <!--<div id="isLoggedIn" style="color:#f68b1f;"></div>-->
  <footer class="tm-footer">
      <center>
        <div id="isLoggedIn" style="color:#002d63;"></div>
        <div style="color:#fff;font-size: 12px;">@LINE Retail Society</div>
      </center>
      <div class="clr" style="height: 50px;"></div>
  </footer>

  <div id="id01" class="w3-modal w3-animate-opacity">
    <div class="w3-modal-content w3-card-4">
      <div class="w3-container" style="min-height:300px;padding:24px;width:100%;text-align:center;">
        <div style="padding-top:20px;color:#0056ff;padding-bottom: 30px;">
          <div id="DisplayUser"></div>
        </div>
        <div class="btn-t2" onclick="CloseAll()">ปิดหน้าต่าง</div>
      </div>
    </div>
    <div class="clr" style="height: 80px;"></div>
  </div>

<script src="./js/registration.js"></script>
<script src='https://use.fontawesome.com/4ecc3dbb0b.js'></script>


<script>
var files = [];
document.getElementById("files").addEventListener("change", function(e) {
  files = e.target.files;
  for (let i = 0; i < files.length; i++) {
    console.log(files[i]);
/*
    ImageTools.resize(this.files[0], {
        width: 320, // maximum width
        height: 240 // maximum height
    }, function(blob, didItResize) {
        document.getElementById('preview').src = window.URL.createObjectURL(blob);
    });
*/

    document.getElementById('Fileimguploading').style.display='block';  
  }
  if (files.length != 0) {
    for (let i = 0; i < files.length; i++) {
      var DateTimeStamp = Math.round(Date.now() / 1000);
      var ImgName = sCampRound+"-"+sessionStorage.getItem("EmpID")+"-"+DateTimeStamp;

//console.log(files[i].size);
//console.log(files[i]);

/*
var a = ImageTools.resize(this.files[i], {
        width: 320, // maximum width
        height: 240 // maximum height
});
console.log(a);
*/

      var uploadTask = firebase.storage().ref('test/'+ImgName).put(files[i]);
      var storage = firebase.storage().ref('test/'+ImgName);
      var upload = storage.put(files[i]);
      upload.on(
        "state_changed",
        function progress(snapshot) {
          var percentage =
          (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        },

        function error() {
          alert("error uploading file");
        },

        function complete() {
          uploadTask.snapshot.ref.getDownloadURL().then(function(url) {
            sessionStorage.setItem("ATKimg", url);
            var a = "<div><center><img src='"+url+"' width='90%'></center></div>";
            $("#MyATKUPloading").html(a);   
            document.getElementById('files').style.display='none';  
            document.getElementById('DisplayUploading').style.display='block';  
            document.getElementById('Fileimguploading').style.display='none'; 
          }
          );
        }
      );
    }
  } else {
    alert("No file chosen");
  }
});

function getFileUrl(filename) {
  //create a storage reference
  var storage = firebase.storage().ref(filename);

  //get file url
  storage
    .getDownloadURL()
    .then(function(url) {
      console.log(url);
      //sessionStorage.setItem("logATK", url);
    })
    .catch(function(error) {
      console.log("error encountered");
    });
}
</script>

</body>
</html>
